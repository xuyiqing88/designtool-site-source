<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>免费ChatGPT - AI助手 - 智能对话/图像识别/文本转语音工具</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="menu.js" defer></script>
    <link rel="icon" href="img/gongjuxiang.svg" type="image/svg">
    <script defer src="https://cloud.umami.is/script.js" data-website-id="5a2e10cd-bf73-47df-be48-079c9ba7783c" data-domains="designtool.site"></script>
    <style>
        :root {
            --main-color: #5a64ff;
            --btcolor: linear-gradient(113deg, #4c73ff, #6a52ff);
            --text1: #1a1d2e;
            --text2: #4a4e6d;
            --text3: #8d8fa3;
            --line: #e2e4f0;
            --mainbg: #f9f9ff;
            --btactive: #e5e8ff;
            --lightbg: #f5f5f8;
            --shadow: #55537512;
            --card-bg: #ffffff;
            --blur: rgba(255, 255, 255, 0.5);
            --button: #5a64ff24;
            --secondary-tab-active: #eef0ff;
            --secondary-tab-hover: #f6f7ff;
            --user-msg-bg: #e2e5fd;
            --ai-msg-bg: #ffffff;
            --success-color: #2ecc71;
            --error-color: #e74c3c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'PingFang SC', 'HarmonyOS_Sans', 'Microsoft YaHei', 'Arial Unicode MS', sans-serif;
        }

        body {
            display: flex;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            background: linear-gradient(0deg, #bbb2ff, #7a6fff);
            color: var(--text1);
            transition: background 0.3s ease;
        }
        .icon {
            display: inline-block;
            width: 1.2em;
            height: 1.2em;
            fill: currentColor;
        }
        .message-file-attachment {
            display: flex;
            align-items: center;
            margin-top: 10px;
            padding: 8px;
            background: #fff;
            border-radius: 8px;
            border: 1px solid var(--line);
        }

        .message-file-attachment img {
            max-width: 60px;
            max-height: 60px;
            border-radius: 6px;
            margin-right: 10px;
        }

        .message-file-attachment span {
            font-size: 14px;
            color: var(--text2);
        }
        .line {
		width: 100%;
		height: 1px;
		background: var(--line);
	    margin: 10px 0;
		}
        .main-layout {
            display: flex;
            flex-grow: 1;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .sidebar {
            width: 250px;
            display: flex;
            flex-direction: column;
            padding: 25px 0;
            flex-shrink: 0;
	        margin-left: 60px;
        }

        .logo {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 0 25px 25px;
            border-bottom: 1px solid #00000012;
            margin-bottom: 20px;
            flex-direction: column;
        }

        .logo h1 {
            font-size: 1.6rem;
            font-weight: 700;
            color: #fff;
            letter-spacing: -0.5px;
            margin-top: 20px;
        }

        .logo .icon {
            font-size: 30px;
            background: var(--btcolor);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: pulse 2s infinite;
        }

        .tabs {
            display: flex;
            flex-direction: column;
            background: none;
            max-width: none;
            margin: 0;
            border-radius: 0;
            padding: 0 20px;
            gap: 10px;
        }

        .tab-btn {
            width: 100%;
            padding: 12px 20px;
            background: none;
            border: none;
            color: #fff;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            justify-content: flex-start;
            border-radius: 10px;
            z-index: 1;
            box-shadow: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tab-btn.active {
            box-shadow: none;
		    background: #00000012;
        }
        
        .tab-btn:hover:not(.active) {
            background: #00000012;
        }

        .main-content {
            flex-grow: 1;
            padding: 15px;
            overflow-y: hidden;
            min-width: 0;
            display: flex;
            flex-direction: column;
        }

        .tab-content {
            min-height: auto;
            padding: 0;
            min-width: auto;
            flex-grow: 1;
            display: flex;
        }

        .tab-pane { display: none; }
        .tab-pane.active { 
            display: flex; 
            flex-grow: 1;
            animation: fadeIn 0.5s ease; }

        .secondary-tabs {
            display: flex;
            background: transparent;
            border-radius: 0;
            margin-bottom: 20px;
            padding: 0 4px;
            border-bottom: 1px solid var(--line);
        }

        .secondary-tab-btn {
            flex: 1;
            padding: 0 15px 15px;
            background: none;
            border: none;
            color: var(--text2);
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;	
            justify-content: center;
            border-radius: 0;
            box-shadow: none;
            position: relative;
        }

        .secondary-tab-btn::after {
            content: '';
            position: absolute;
            left: 50%;
            bottom: -1px;
            transform: translateX(-50%);
            width: 0;
            height: 3px;
            background: var(--main-color);
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        .secondary-tab-btn.active {
            background: transparent;
            color: var(--main-color);
            font-weight: 600;
            box-shadow: none;
        }

        .secondary-tab-btn.active::after {
            width: 50%;
        }

        .secondary-tab-btn:hover {
            color: var(--main-color);
        }
        
        .secondary-tab-btn:not(.active):hover::after {
            width: 40%;
        }

        .secondary-tab-pane { 
            display: none; 
            flex: 1;
            flex-direction: column;
            max-height: 88vh;
        }
        
        .secondary-tab-pane.active { 
            display: flex; 
            overflow-y: auto;
            overflow-x: hidden;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .panel {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .panel h2 {
            font-size: 20px;
            margin-bottom: 10px;
            color: var(--text1);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .panel-description {
            color: var(--text2);
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .panel h2 .icon {
            color: var(--main-color);
        }

        .panel-title-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .reset-btn {
            background: var(--mainbg);
            color: var(--text2);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 13px;
            border: 1px solid var(--line);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 500;
        }

        .reset-btn:hover {
            background: var(--button);
            transform: translateY(-1px);
        }
        
        textarea, input[type="text"], input[type="password"], select {
            width: 100%;
            padding: 16px 16px 38px 16px;
            border-radius: 12px;
            border: 1px solid var(--line);
            background: var(--mainbg);
            color: var(--text1);
            font-size: 15px;
            resize: vertical;
            transition: all 0.3s;
        }
        
        textarea { min-height: 160px; }
        
        .settings-item textarea {
            padding: 8px 18px !important;
            min-height: 130px !important;
        }

        textarea:focus, input[type="text"]:focus, input[type="password"]:focus, select:focus {
            outline: none;
            border-color: var(--main-color);
        }
        
        .input-wrapper {
            position: relative;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
        }

        button {
            padding: 10px 24px;
            border-radius: 24px;
            border: none;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }

        .btn-primary {
            background: var(--btcolor);
            color: white;
            box-shadow: 0 4px 15px rgba(89, 99, 255, 0.25);
        }

        .btn-primary:hover {
            opacity: 0.92;
            box-shadow: 0 7px 18px rgba(89, 99, 255, 0.35);
        }

        .btn-secondary {
            background: var(--card-bg);
            color: var(--text2);
            border: 1px solid var(--line);
        }

        .btn-secondary:hover {
            background: var(--btactive);
            color: var(--main-color);
            transform: translateY(-2px);
        }
        
        #clearChatBtn:hover, #clearExpandBtn:hover {
             color: #e74c3c;
             border-color: #f5c8c4;
        }

        .btn-disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        .upload-container {
            position: relative;
            border: 2px dashed var(--line);
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--mainbg);
            min-height: 240px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .upload-container:hover {
            border-color: var(--main-color);
            background: var(--btactive);
        }

        .upload-icon {
            font-size: 48px;
            color: var(--main-color);
            margin-bottom: 18px;
            opacity: 0.7;
        }

        .upload-container p { color: var(--text3); font-size: 16px; }

        #imagePreview {
            max-width: 100%;
            max-height: 320px;
            border-radius: 12px;
            display: none;
            object-fit: contain;
            margin: 0 auto;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .close-preview {
            position: absolute;
            top: 12px;
            right: 12px;
            color: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            font-size: 30px;
            transition: all 0.3s;
        }

        .close-preview:hover {
            color: rgba(0, 0, 0, 0.9);
            transform: rotate(90deg);
        }

        .response-area {
            margin-top: 30px;
            border-radius: 10px;
            border: 1px solid var(--line);
            min-height: 160px;
            max-height: 400px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .response-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--line);
            padding: 12px 20px;
            background: var(--card-bg);
            border-radius: 16px 16px 0 0;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .response-header h3 {
            color: var(--text1);
            font-size: 17px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .response-header h3 .icon { color: var(--main-color); }

        .copy-btn {
            background: none;
            border: none;
            color: var(--text2);
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 8px;
            background: var(--mainbg);
            transition: all 0.3s;
        }

        .copy-btn:hover {
            background: var(--btactive);
            color: var(--main-color);
            transform: translateY(-1px);
        }

        .response-content {
            color: var(--text2);
            line-height: 1.7;
            font-size: 15px;
            margin: 20px;
            flex-grow: 1;
        }

        .settings-pane {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            width: 100%;
        }
        
        .settings-pane h2 {
            color: var(--text1);
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .settings-pane h2 .icon { color: var(--main-color); }

        .settings-item { margin-bottom: 18px; }

        .settings-item label {
            display: block;
            margin-bottom: 8px;
            color: var(--text1);
            font-weight: 500;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: space-between;
        }
        
        .settings-item select {
            -webkit-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%238d8fa3' class='bi bi-chevron-down' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
        }

        .settings-item input, .settings-item textarea, .settings-item select {
            width: 100%;
            padding: 8px 18px;
            border-radius: 6px;
            font-size: 15px;
            line-height: 1.5;
        }

        .settings-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 25px;
        }
        
        .alert {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 35px;
            border-radius: 12px;
            color: white;
            box-shadow: 0 8px 25px var(--shadow);
            z-index: 1001;
            animation: fadeInOut 3s forwards;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .alert.success { background: var(--success-color); }
        .alert.error { background: var(--error-color); }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, -20px); }
            10% { opacity: 1; transform: translate(-50%, 0); }
            90% { opacity: 1; transform: translate(-50%, 0); }
            100% { opacity: 0; transform: translate(-50%, -20px); }
        }

        .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-left: 8px;
            box-shadow: 0 0 8px;
        }
        
        .status-online { background-color: var(--success-color); color: var(--success-color); }
        .status-offline { background-color: var(--error-color); color: var(--error-color); }

        .chat-history {
            display: flex;
            flex-direction: column;
            gap: 20px;
            flex-grow: 1;
            overflow-y: auto;
            border-radius: 4px 4px 10px 10px;
            margin-bottom: 10px;
        }
        
        .chat-history::-webkit-scrollbar { width: 10px; height: 10px; }
        .chat-history::-webkit-scrollbar-track { background: #ffffff00; border-radius: 6px; }
        .chat-history::-webkit-scrollbar-thumb { background: #dddde5; border-radius: 6px; border: 2px solid transparent; background-clip: content-box; }
        .chat-history::-webkit-scrollbar-thumb:hover { background: #a9a9b152; }
        .chat-history::-webkit-scrollbar-corner { background: #00ffd242; }
        
        .history-placeholder {
            color: var(--text3);
            text-align: center;
            padding: 40px;
            font-style: italic;
            opacity: 0.7;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 15px;
            height: 100%;
        }
        
        .history-placeholder .icon { font-size: 32px; }
        
        .message {
            display: flex;
            gap: 15px;
            max-width: 85%;
            animation: fadeIn 0.4s ease;
        }
        
        .user-message { align-self: flex-end; flex-direction: row-reverse; }
        .ai-message { align-self: flex-start; }
        
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--lightbg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--main-color);
            font-size: 18px;
            flex-shrink: 0;
            overflow: hidden;
        }

        .message-bubble {
            padding: 16px 20px;
            border-radius: 12px;
            word-break: break-word;
        }

        .user-message .message-bubble { background: var(--user-msg-bg); border-top-right-radius: 4px; padding: 15px; }
        .ai-message .message-bubble { background: var(--lightbg); border-top-left-radius: 4px; padding: 15px; }
        .ai-message.initial .message-bubble { background: radial-gradient(185% 45% at 100% 0%, #e6008100, #f9f9fe), linear-gradient(90deg, #D0EFFF, #d4dcff, #ffd9f2); width: 480px; }
        .ai-message.initial .message-content strong { font-size: 1.25em; font-weight: bold; line-height: 1.5; }
        
        .message-content {
            line-height: 1.3;
            white-space: pre-wrap;
            word-break: break-word;
            font-size: 15px;
        }

        .message-content strong { font-weight: 700; }
        .message-content h1, .message-content h2, .message-content h3, .message-content h4, .message-content h5, .message-content h6 { margin-top: 1em; margin-bottom: 0.5em; font-weight: bold; color: var(--text1); }
        .message-content h1 { font-size: 1.6em; }
        .message-content h2 { font-size: 1.4em; }
        .message-content h3 { font-size: 1.2em; }
        .message-content h4 { font-size: 1.1em; }
        .message-content h5 { font-size: 1em; }
        .message-content h6 { font-size: 0.9em; }
        .message-content ul, .message-content ol { margin-left: 20px; padding-left: 0; margin-bottom: 0; }
        .message-content ul li { list-style-type: disc; margin-bottom: 0; }
        .message-content ol li { list-style-type: decimal; margin-bottom: 0; }
        .message-content pre { background-color: var(--mainbg); border-radius: 8px; padding: 15px; overflow-x: auto; font-family: 'SF Mono', 'Cascadia Code', 'Fira Code', monospace; font-size: 0.9em; margin-top: 10px; margin-bottom: 10px; white-space: pre-wrap; word-break: break-all; }
        .message-content code { background-color: var(--lightbg); padding: 3px 6px; border-radius: 4px; font-family: 'SF Mono', 'Cascadia Code', 'Fira Code', monospace; font-size: 0.9em; color: var(--text2); }
        .message-content pre code { background-color: transparent; padding: 0; border-radius: 0; color: inherit; white-space: pre; word-break: break-word; }
        .message-content img { max-width: 100%; height: auto; border-radius: 10px; margin-top: 10px; cursor: pointer; }
        
        .message-footer { display: flex; justify-content: flex-end; align-items: center; margin-top: 5px; gap: 15px; }
        .message-time { font-size: 12px; color: var(--text3); }
        .copy-message-btn { background: none; border: none; color: var(--text3); font-size: 14px; cursor: pointer; display: flex; align-items: center; gap: 4px; padding: 4px; border-radius: 6px; transition: all 0.3s; }
        .message-bubble:hover .copy-message-btn { opacity: 1; }
        .copy-message-btn:hover { background: var(--lightbg);}
        
        .chat-input-area { position: relative; }
        .chat-input-area .btn-group { position: absolute; right: 10px; bottom: -5px; transform: translateY(-50%); margin: 0; gap: 8px; }
        .chat-input-area .btn-group button { padding: 8px; width: 40px; height: 40px; background: none; border: none; }
        
        .vision-layout { display: grid; gap: 25px; grid-template-columns: 0.65fr 1.5fr; }
        .vision-layout > div { flex: 1; display: flex; flex-direction: column; }
        .vision-layout .upload-container { margin-bottom: 0; }
        .vision-layout .response-area { margin-top: 0; }
        .vision-buttons { display: flex; justify-content: flex-end; gap: 15px; margin-bottom: 10px; margin-right: 10px; }
        
        .tts-container { display: flex; flex-direction: column; gap: 20px; }
        .tts-controls { display: flex; gap: 15px; align-items: center; margin-top: 10px; }
        .tts-controls label { font-size: 14px; font-weight: 500; color: var(--text2); white-space: nowrap; }
        #voiceSelect { flex: 1; padding: 10px; border-radius: 8px; border: 1px solid var(--line); background: var(--mainbg); font-size: 14px; }
        .audio-player { margin-top: 20px; display: none; }
        .audio-player audio { width: 100%; }
        .audio-actions { display: flex; justify-content: center; gap: 15px; margin-top: 15px; }
        
        .template-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .template-label { font-weight: 600; color: var(--text2); font-size: 16px; }
        .template-actions { display: flex; gap: 10px; }
        .template-btn { padding: 6px 12px; font-size: 13px; border-radius: 8px; background: var(--mainbg); border: 1px solid var(--line); cursor: pointer; display: flex; align-items: center; gap: 5px; }
        .template-btn:hover { background: var(--button); color: var(--main-color); }
        .template-description { color: var(--text3); font-size: 13px; margin-top: 8px; margin-bottom: 15px; line-height: 1.5; }
        
        @media (max-width: 768px) {
            .main-layout { flex-direction: column-reverse; }
            .ai-message.initial .message-bubble { width: auto; }
            .secondary-tab-pane{ max-height: calc(100vh - 100px); }
            .panel {padding: 16px;}
            .sidebar { width: 100%; height: auto; flex-direction: row; padding: 12px 0; border-right: none; justify-content: center; align-items: center; margin-left: 0; background: #fff; box-shadow: 0 -2px 10px #0000000d; position: fixed; bottom: 0; z-index: 999; }
            .chat-input-area { margin-bottom: 20px;}
            textarea {min-height: 130px;}
            .message { gap: 8px; }
            .logo { display: none; }
            .tabs { flex-direction: row; gap: 5px; flex-grow: 1; justify-content: space-around; }
            .tab-btn { flex: 1; text-align: center; justify-content: center; margin-bottom: 0; font-size: 12px; padding: 0; gap: 4px; flex-direction: column; color: var(--text3); font-weight: 400; }
            .tab-btn.active { color: var(--main-color); background: none; }
            .tab-btn .icon { margin-right: 4px; font-size: 16px; }
            .panel h2 .icon { display: none; }	
            .panel h2 { justify-content: center; }
            body { background: #fff; }
            .main-content { padding: 0; padding-bottom: 80px; }
            .vision-layout { flex-direction: column; display: flex; }
            .upload-container {min-height: 190px;}
            .message-avatar { display: none; }
        }
    </style>
</head>

<body>
<svg width="0" height="0" class="hidden">
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="comments-solid-full"><path d="M416 208C416 305.2 330 384 224 384C197.3 384 171.9 379 148.8 370L67.2 413.2C57.9 418.1 46.5 416.4 39 409C31.5 401.6 29.8 390.1 34.8 380.8L70.4 313.6C46.3 284.2 32 247.6 32 208C32 110.8 118 32 224 32C330 32 416 110.8 416 208zM416 576C321.9 576 243.6 513.9 227.2 432C347.2 430.5 451.5 345.1 463 229.3C546.3 248.5 608 317.6 608 400C608 439.6 593.7 476.2 569.6 505.6L605.2 572.8C610.1 582.1 608.4 593.5 601 601C593.6 608.5 582.1 610.2 572.8 605.2L491.2 562C468.1 571 442.7 576 416 576z"/></symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="image-solid-full"><path d="M160 96C124.7 96 96 124.7 96 160L96 480C96 515.3 124.7 544 160 544L480 544C515.3 544 544 515.3 544 480L544 160C544 124.7 515.3 96 480 96L160 96zM224 176C250.5 176 272 197.5 272 224C272 250.5 250.5 272 224 272C197.5 272 176 250.5 176 224C176 197.5 197.5 176 224 176zM368 288C376.4 288 384.1 292.4 388.5 299.5L476.5 443.5C481 450.9 481.2 460.2 477 467.8C472.8 475.4 464.7 480 456 480L184 480C175.1 480 166.8 475 162.7 467.1C158.6 459.2 159.2 449.6 164.3 442.3L220.3 362.3C224.8 355.9 232.1 352.1 240 352.1C247.9 352.1 255.2 355.9 259.7 362.3L286.1 400.1L347.5 299.6C351.9 292.5 359.6 288.1 368 288.1z"/></symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="volume-high-solid-full"><path d="M533.6 96.5C523.3 88.1 508.2 89.7 499.8 100C491.4 110.3 493 125.4 503.3 133.8C557.5 177.8 592 244.8 592 320C592 395.2 557.5 462.2 503.3 506.3C493 514.7 491.5 529.8 499.8 540.1C508.1 550.4 523.3 551.9 533.6 543.6C598.5 490.7 640 410.2 640 320C640 229.8 598.5 149.2 533.6 96.5zM473.1 171C462.8 162.6 447.7 164.2 439.3 174.5C430.9 184.8 432.5 199.9 442.8 208.3C475.3 234.7 496 274.9 496 320C496 365.1 475.3 405.3 442.8 431.8C432.5 440.2 431 455.3 439.3 465.6C447.6 475.9 462.8 477.4 473.1 469.1C516.3 433.9 544 380.2 544 320.1C544 260 516.3 206.3 473.1 171.1zM412.6 245.5C402.3 237.1 387.2 238.7 378.8 249C370.4 259.3 372 274.4 382.3 282.8C393.1 291.6 400 305 400 320C400 335 393.1 348.4 382.3 357.3C372 365.7 370.5 380.8 378.8 391.1C387.1 401.4 402.3 402.9 412.6 394.6C434.1 376.9 448 350.1 448 320C448 289.9 434.1 263.1 412.6 245.5zM80 416L128 416L262.1 535.2C268.5 540.9 276.7 544 285.2 544C304.4 544 320 528.4 320 509.2L320 130.8C320 111.6 304.4 96 285.2 96C276.7 96 268.5 99.1 262.1 104.8L128 224L80 224C53.5 224 32 245.5 32 272L32 368C32 394.5 53.5 416 80 416z"/></symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="circle-xmark-solid-full"><path d="M320 576C461.4 576 576 461.4 576 320C576 178.6 461.4 64 320 64C178.6 64 64 178.6 64 320C64 461.4 178.6 576 320 576zM231 231C240.4 221.6 255.6 221.6 264.9 231L319.9 286L374.9 231C384.3 221.6 399.5 221.6 408.8 231C418.1 240.4 418.2 255.6 408.8 264.9L353.8 319.9L408.8 374.9C418.2 384.3 418.2 399.5 408.8 408.8C399.4 418.1 384.2 418.2 374.9 408.8L319.9 353.8L264.9 408.8C255.5 418.2 240.3 418.2 231 408.8C221.7 399.4 221.6 384.2 231 374.9L286 319.9L231 264.9C221.6 255.5 221.6 240.3 231 231z"/></symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="eraser-solid-full"><path d="M210.5 480L333.5 480L398.8 414.7L225.3 241.2L98.6 367.9L210.6 479.9zM256 544L210.5 544C193.5 544 177.2 537.3 165.2 525.3L49 409C38.1 398.1 32 383.4 32 368C32 352.6 38.1 337.9 49 327L295 81C305.9 70.1 320.6 64 336 64C351.4 64 366.1 70.1 377 81L559 263C569.9 273.9 576 288.6 576 304C576 319.4 569.9 334.1 559 345L424 480L544 480C561.7 480 576 494.3 576 512C576 529.7 561.7 544 544 544L256 544z"/></symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="paper-plane-solid-full"><path d="M568.4 37.7C578.2 34.2 589 36.7 596.4 44C603.8 51.3 606.2 62.2 602.7 72L424.7 568.9C419.7 582.8 406.6 592 391.9 592C377.7 592 364.9 583.4 359.6 570.3L295.4 412.3C290.9 401.3 292.9 388.7 300.6 379.7L395.1 267.3C400.2 261.2 399.8 252.3 394.2 246.7C388.6 241.1 379.6 240.7 373.6 245.8L261.2 340.1C252.1 347.7 239.6 349.7 228.6 345.3L70.1 280.8C57 275.5 48.4 262.7 48.4 248.5C48.4 233.8 57.6 220.7 71.5 215.7L568.4 37.7z"/></symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="arrow-rotate-left-solid-full"><path d="M320 128C263.2 128 212.1 152.7 176.9 192L224 192C241.7 192 256 206.3 256 224C256 241.7 241.7 256 224 256L96 256C78.3 256 64 241.7 64 224L64 96C64 78.3 78.3 64 96 64C113.7 64 128 78.3 128 96L128 150.7C174.9 97.6 243.5 64 320 64C461.4 64 576 178.6 576 320C576 461.4 461.4 576 320 576C233 576 156.1 532.6 109.9 466.3C99.8 451.8 103.3 431.9 117.8 421.7C132.3 411.5 152.2 415.1 162.4 429.6C197.2 479.4 254.8 511.9 320 511.9C426 511.9 512 425.9 512 319.9C512 213.9 426 128 320 128z"/></symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="wand-magic-sparkles-solid-full"><path d="M295.4 37L310.2 73.8L347 88.6C350 89.8 352 92.8 352 96C352 99.2 350 102.2 347 103.4L310.2 118.2L295.4 155C294.2 158 291.2 160 288 160C284.8 160 281.8 158 280.6 155L265.8 118.2L229 103.4C226 102.2 224 99.2 224 96C224 92.8 226 89.8 229 88.6L265.8 73.8L280.6 37C281.8 34 284.8 32 288 32C291.2 32 294.2 34 295.4 37zM142.7 105.7L164.2 155.8L214.3 177.3C220.2 179.8 224 185.6 224 192C224 198.4 220.2 204.2 214.3 206.7L164.2 228.2L142.7 278.3C140.2 284.2 134.4 288 128 288C121.6 288 115.8 284.2 113.3 278.3L91.8 228.2L41.7 206.7C35.8 204.2 32 198.4 32 192C32 185.6 35.8 179.8 41.7 177.3L91.8 155.8L113.3 105.7C115.8 99.8 121.6 96 128 96C134.4 96 140.2 99.8 142.7 105.7zM496 368C502.4 368 508.2 371.8 510.7 377.7L532.2 427.8L582.3 449.3C588.2 451.8 592 457.6 592 464C592 470.4 588.2 476.2 582.3 478.7L532.2 500.2L510.7 550.3C508.2 556.2 502.4 560 496 560C489.6 560 483.8 556.2 481.3 550.3L459.8 500.2L409.7 478.7C403.8 476.2 400 470.4 400 464C400 457.6 403.8 451.8 409.7 449.3L459.8 427.8L481.3 377.7C483.8 371.8 489.6 368 496 368zM492 64C503 64 513.6 68.4 521.5 76.2L563.8 118.5C571.6 126.4 576 137 576 148C576 159 571.6 169.6 563.8 177.5L475.6 265.7L374.3 164.4L462.5 76.2C470.4 68.4 481 64 492 64zM76.2 462.5L340.4 198.3L441.7 299.6L177.5 563.8C169.6 571.6 159 576 148 576C137 576 126.4 571.6 118.5 563.8L76.2 521.5C68.4 513.6 64 503 64 492C64 481 68.4 470.4 76.2 462.5z"/></symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="glasses-solid-full"><path d="M175.3 160C161.3 160 148.8 169.2 144.7 182.6L102.4 320L256 320C273.7 320 288 334.3 288 352L352 352C352 334.3 366.3 320 384 320L537.6 320L495.3 182.6C491.2 169.2 478.8 160 464.7 160L432 160C414.3 160 400 145.7 400 128C400 110.3 414.3 96 432 96L464.7 96C506.8 96 544.1 123.5 556.5 163.8L601.9 311.3C606 324.5 608 338.2 608 352L608 448C608 501 565 544 512 544L448 544C395 544 352 501 352 448L352 416L288 416L288 448C288 501 245 544 192 544L128 544C75 544 32 501 32 448L32 352C32 338.2 34.1 324.5 38.1 311.3L83.5 163.8C95.9 123.5 133.1 96 175.3 96L208 96C225.7 96 240 110.3 240 128C240 145.7 225.7 160 208 160L175.3 160zM96 384L96 448C96 465.7 110.3 480 128 480L192 480C209.7 480 224 465.7 224 448L224 384L96 384zM512 480C529.7 480 544 465.7 544 448L544 384L416 384L416 448C416 465.7 430.3 480 448 480L512 480z"/></symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="cloud-arrow-up-solid-full"><path d="M176 544C96.5 544 32 479.5 32 400C32 336.6 73 282.8 129.9 263.5C128.6 255.8 128 248 128 240C128 160.5 192.5 96 272 96C327.4 96 375.5 127.3 399.6 173.1C413.8 164.8 430.4 160 448 160C501 160 544 203 544 256C544 271.7 540.2 286.6 533.5 299.7C577.5 320 608 364.4 608 416C608 486.7 550.7 544 480 544L176 544zM337 255C327.6 245.6 312.4 245.6 303.1 255L231.1 327C221.7 336.4 221.7 351.6 231.1 360.9C240.5 370.2 255.7 370.3 265 360.9L296 329.9L296 432C296 445.3 306.7 456 320 456C333.3 456 344 445.3 344 432L344 329.9L375 360.9C384.4 370.3 399.6 370.3 408.9 360.9C418.2 351.5 418.3 336.3 408.9 327L336.9 255z"/></symbol>
  <symbol version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 16 16" id="copy"><title>复制@2x</title><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g stroke="#6F7189" stroke-width="1.25"><rect x="5.5" y="1.5" width="8.75" height="8.75" rx="2"></rect><path d="M11.375,12.5237302 C11.375,13.5406354 10.5506354,14.365 9.53373016,14.365 L3.21626984,14.365 C2.19936459,14.365 1.375,13.5406354 1.375,12.5237302 L1.375,6.20626984 C1.375,5.18936459 2.19936459,4.365 3.21626984,4.365" stroke-linecap="round" stroke-linejoin="round"></path></g></g></symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="rotate-solid-full"><path d="M544.1 256L552 256C565.3 256 576 245.3 576 232L576 88C576 78.3 570.2 69.5 561.2 65.8C552.2 62.1 541.9 64.2 535 71L483.3 122.8C439 86.1 382 64 320 64C191 64 84.3 159.4 66.6 283.5C64.1 301 76.2 317.2 93.7 319.7C111.2 322.2 127.4 310 129.9 292.6C143.2 199.5 223.3 128 320 128C364.4 128 405.2 143 437.7 168.3L391 215C384.1 221.9 382.1 232.2 385.8 241.2C389.5 250.2 398.3 256 408 256L544.1 256zM573.5 356.5C576 339 563.8 322.8 546.4 320.3C529 317.8 512.7 330 510.2 347.4C496.9 440.4 416.8 511.9 320.1 511.9C275.7 511.9 234.9 496.9 202.4 471.6L249 425C255.9 418.1 257.9 407.8 254.2 398.8C250.5 389.8 241.7 384 232 384L88 384C74.7 384 64 394.7 64 408L64 552C64 561.7 69.8 570.5 78.8 574.2C87.8 577.9 98.1 575.8 105 569L156.8 517.2C201 553.9 258 576 320 576C449 576 555.7 480.6 573.4 356.5z"/></symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="play-solid-full"><path d="M187.2 100.9C174.8 94.1 159.8 94.4 147.6 101.6C135.4 108.8 128 121.9 128 136L128 504C128 518.1 135.5 531.2 147.6 538.4C159.7 545.6 174.8 545.9 187.2 539.1L523.2 355.1C536 348.1 544 334.6 544 320C544 305.4 536 291.9 523.2 284.9L187.2 100.9z"/></symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="download-solid-full"><path d="M288 32c0-17.7-14.3-32-32-32s-32 14.3-32 32V274.7l-73.4-73.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0l128-128c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L288 274.7V32zM64 352c-35.3 0-64 28.7-64 64v32c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V416c0-35.3-28.7-64-64-64H346.5l-45.3 45.3c-25 25-65.5 25-90.5 0L165.5 352H64zm368 56a24 24 0 1 1 0 48 24 24 0 1 1 0-48z"/></symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="circle-check-solid-full"><path d="M320 576C178.6 576 64 461.4 64 320C64 178.6 178.6 64 320 64C461.4 64 576 178.6 576 320C576 461.4 461.4 576 320 576zM438 209.7C427.3 201.9 412.3 204.3 404.5 215L285.1 379.2L233 327.1C223.6 317.7 208.4 317.7 199.1 327.1C189.8 336.5 189.7 351.7 199.1 361L271.1 433C276.1 438 282.9 440.5 289.9 440C296.9 439.5 303.3 435.9 307.4 430.2L443.3 243.2C451.1 232.5 448.7 217.5 438 209.7z"/></symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="circle-exclamation-solid-full"><path d="M320 576C178.6 576 64 461.4 64 320C64 178.6 178.6 64 320 64C461.4 64 576 178.6 576 320C576 461.4 461.4 576 320 576zM320 384C302.3 384 288 398.3 288 416C288 433.7 302.3 448 320 448C337.7 448 352 433.7 352 416C352 398.3 337.7 384 320 384zM320 192C301.8 192 287.3 207.5 288.6 225.7L296 329.7C296.9 342.3 307.4 352 319.9 352C332.5 352 342.9 342.3 343.8 329.7L351.2 225.7C352.5 207.5 338.1 192 319.8 192z"/></symbol>
</svg>
<div id="global-sidebar"></div>
    <div class="main-layout">
        <div class="sidebar">
            <div class="logo">
                <h1>免费版ChatGPT AI助手 <span class="status-indicator status-online"></span></h1>
                <p class="panel-description" style="color: #fff;">本站使用ChatGPT模型，完全免费使用！无需设置API密钥</p>
            </div>
            
            <div class="tabs">
                <button class="tab-btn active" data-tab="chat">
                    <svg class="icon"><use xlink:href="#comments-solid-full"></use></svg> AI对话
                </button>
                <button class="tab-btn" data-tab="vision">
                    <svg class="icon"><use xlink:href="#image-solid-full"></use></svg> AI图像识别
                </button>
                <button class="tab-btn" data-tab="tts">
                    <svg class="icon"><use xlink:href="#volume-high-solid-full"></use></svg> 文本转语音
                </button>
            </div>
        </div>
        
        <div class="main-content">
            <div class="tab-content">
                <div class="tab-pane active" id="chatTab">
                    <div class="panel">
                        <div class="secondary-tabs">
                            <button class="secondary-tab-btn active" data-subtab="conversation" data-parent="chat">自由对话</button>
                            <button class="secondary-tab-btn" data-subtab="prompt" data-parent="chat">提示词扩写</button>
                        </div>
                    
                        <div class="secondary-tab-pane active" id="conversationSubTab">
                            <h2 style="display: none;">自由对话</h2>
                            <div class="chat-history scrollable" id="chatHistory">
                                </div>
                            <div id="chatFilePreview" style="display: none; margin-bottom: 10px; align-items: center; gap: 10px; padding: 8px 12px; background: var(--mainbg); border-radius: 8px; border: 1px solid var(--line);">
                                <div id="chatFileDisplay" style="display: flex; align-items: center; gap: 10px;">
                                    <img id="chatImagePreview" alt="preview" style="max-width: 60px; max-height: 60px; border-radius: 6px; display: none;">
                                    <svg class="icon" id="chatFileIcon" style="font-size: 24px; color: var(--main-color); display: none;"><use xlink:href="#image-solid-full"></use></svg>
                                </div>
                                <span id="chatFilePreviewName" style="flex-grow: 1; font-size: 14px; color: var(--text2);"></span>
                                <svg class="icon" id="removeChatFile" title="移除文件" style="cursor: pointer; color: var(--text3);"><use xlink:href="#circle-xmark-solid-full"></use></svg>
                            </div>
                            
                            <div class="chat-input-area">
                                <textarea id="chatInput" placeholder="输入您的问题或想法（按Enter发送，Shift+Enter换行），支持上传图片" rows="1"></textarea>
                                <div class="btn-group">
                                    <button class="btn-secondary" id="uploadImageBtn" title="上传图片">
                                        <svg class="icon"><use xlink:href="#image-solid-full"></use></svg>
                                    </button>
                                    <button class="btn-secondary" id="clearChatBtn" title="清空对话历史" style="margin-right: 16px;">
                                        <svg class="icon"><use xlink:href="#eraser-solid-full"></use></svg>
                                    </button>
                                    <button class="btn-primary" id="sendBtn" title="发送消息" style="width: 62px; background: var(--btcolor);">
                                        <svg class="icon"><use xlink:href="#paper-plane-solid-full"></use></svg>
                                    </button>
                                </div>
                                <input type="file" id="imageUploadInput" accept="image/*" style="display: none;">
                            </div>
                        </div>

                        <div class="secondary-tab-pane" id="promptSubTab">                            
                            <div class="template-controls">
                                <div class="template-label">提示词模板</div>
                                <div class="template-actions">
                                    <button class="template-btn" id="resetPromptTemplate">
                                        <svg class="icon"><use xlink:href="#arrow-rotate-left-solid-full"></use></svg> 恢复默认
                                    </button>
                                </div>
                            </div>
                            <div class="panel-description">
                                该模板用于生成适合AI绘画的详细描述。第一步描述图像内容，第二步基于描述生成高质量的提示词。
                            </div>
                            
                            <div class="chat-input-area">
                                 <textarea id="promptTemplate" placeholder="在此输入提示词模板..." style="min-height: 150px;"></textarea>
                                 <textarea id="promptInput" placeholder="在此输入您的原始提示词..." style="min-height: 150px; margin-top: 15px;"></textarea>
                                 <div class="btn-group">
                                    <button class="btn-secondary" id="clearExpandBtn" style="margin-right: 16px;">
                                        <svg class="icon"><use xlink:href="#eraser-solid-full"></use></svg> 
                                    </button>
                                    <button class="btn-primary" id="expandBtn" style="width: 62px; background: var(--btcolor);">
                                        <svg class="icon"><use xlink:href="#wand-magic-sparkles-solid-full"></use></svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-pane" id="visionTab">
                    <div class="panel">                        
                        <div id="image-analysisSubTab" class="secondary-tab-pane active">
                            <h2><svg class="icon"><use xlink:href="#glasses-solid-full"></use></svg> 图像识别（提示词反推）</h2>
				            <div class="line"></div>                           
                            <div class="template-controls">
                                <div class="template-label">提示词模板</div>
                                <div class="template-actions">
                                    <button class="template-btn" id="resetVisionTemplate">
                                        <svg class="icon"><use xlink:href="#arrow-rotate-left-solid-full"></use></svg> 恢复默认
                                    </button>
                                </div>
                            </div>
                            <div class="panel-description">
                                该模板用于分析图像并生成适合AI图像生成的详细提示词。首先详细描述图像内容，然后基于描述生成高质量的提示词。
                            </div>
                           <textarea id="visionTemplate" placeholder="在此输入提示词模板..." style="margin-bottom: 15px;"></textarea>
                            <div class="vision-layout">
                                <div>
                                    <div class="upload-container" id="uploadArea">
                                        <div id="uploadContent">
                                            <div class="upload-icon">
                                                <svg class="icon"><use xlink:href="#cloud-arrow-up-solid-full"></use></svg>
                                            </div>
                                            <p>拖放图片到此处或<br><b>点击上传</b></p>
                                        </div>
                                        <img id="imagePreview" alt="预览图片">
                                        <div class="close-preview" id="closePreview" style="display: none;">
                                            <svg class="icon"><use xlink:href="#circle-xmark-solid-full"></use></svg>
                                        </div>
                                        <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                                    </div>
                                </div>
                                <div>
                                    <div class="response-area" id="visionResponseArea">
                                        <div class="response-header">
                                            <h3> AI分析结果</h3>
                                            <button class="copy-btn" id="copyVisionBtn" title="复制结果">
                                                <svg class="icon" style="width:14px; height:14px;"><use xlink:href="#copy"></use></svg> 复制
                                            </button>
                                        </div>
                                        <div class="response-content" id="visionResponse">
                                            图片上传后将自动分析...
                                        </div>
                                        <div class="btn-group vision-buttons">
                                            <button class="btn-primary" id="regenerateVisionBtn">
                                                <svg class="icon"><use xlink:href="#rotate-solid-full"></use></svg> 重新生成
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                
                <div class="tab-pane" id="ttsTab">
                    <div class="panel">
                        <h2><svg class="icon"><use xlink:href="#volume-high-solid-full"></use></svg> 文本转语音</h2>
                        <p class="panel-description">
                            输入文本内容，AI将为您生成自然流畅的语音。
                        </p>
                        <div class="tts-container">
                            <div class="chat-input-area">
                                <textarea id="ttsInput" placeholder="在此输入要转换为语音的文本..." style="min-height: 280px;"></textarea>
                                <div class="tts-controls">
                                    <label for="voiceSelect">选择语音：</label>
                                    <select id="voiceSelect">
                                        </select>
                                </div>
                            </div>
                            <div class="btn-group">
                                <button class="btn-secondary" id="clearTtsBtn">
                                    <svg class="icon"><use xlink:href="#eraser-solid-full"></use></svg> 清除文本
                                </button>
                                <button class="btn-primary" id="generateTtsBtn" style="background: var(--btcolor);">
                                    <svg class="icon"><use xlink:href="#play-solid-full"></use></svg> 生成语音
                                </button>
                            </div>
                            
                            <div class="audio-player" id="audioPlayer">
                                <audio controls id="ttsAudio"></audio>
                                <div class="audio-actions">
                                    <button class="btn-secondary" id="downloadTtsBtn">
                                        <svg class="icon"><use xlink:href="#download-solid-full"></use></svg> 下载
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="alertContainer"></div>

    <script>
        // 新增函数：加载可用语音
        function loadVoices() {
          return new Promise((resolve) => {
            const synth = window.speechSynthesis;
            let voices = synth.getVoices();
            if (voices.length) return resolve(voices);
            
            synth.onvoiceschanged = () => resolve(synth.getVoices());
          });
        }

        // 初始化时填充语音下拉菜单
        async function initTts() {
          const voices = await loadVoices();
          const voiceSelect = document.getElementById('voiceSelect');
          voiceSelect.innerHTML = '';
          
          // 优先选择中文语音，如果没有则填充所有可用语音
          let filteredVoices = voices.filter(v => v.lang.includes('zh') || v.lang.includes('CN'));
          if (filteredVoices.length === 0) {
              filteredVoices = voices;
          }

          filteredVoices.forEach(voice => {
            const option = document.createElement('option');
            option.value = voice.name;
            option.textContent = `${voice.name} (${voice.lang})`;
            voiceSelect.appendChild(option);
          });
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            initTts();
            // 状态变量
            let apiHistory = [];
            let displayHistory = [];
            let visionUploadedFile = null;
            let lastRequestTime = 0;
            const REQUEST_INTERVAL = 15000;  // 15秒
            
            // 默认模板
            const DEFAULT_PROMPT_TEMPLATE = "You are creating a prompt for Stable Diffusion to generate an image. First step: describe this image, then put description into text. Second step: generate a text prompt for %s based on first step. Only respond with the prompt itself, but embellish it as needed but keep it under 120 tokens.";
            const DEFAULT_VISION_TEMPLATE = "Describe the uploaded image in detail, covering the main subjects, setting, colors, style, and atmosphere. Then, based on your description, generate a high-quality, detailed prompt suitable for an image generation model, only respond with the prompt, keep it under 120 tokens.";
            
            // DOM元素
            const mainTabBtns = document.querySelectorAll('.tab-btn');
            const mainTabPanes = document.querySelectorAll('.tab-pane');
            const secondaryTabBtns = document.querySelectorAll('.secondary-tab-btn');
            const secondaryTabPanes = document.querySelectorAll('.secondary-tab-pane');
            const uploadImageBtn = document.getElementById('uploadImageBtn');
            const imageUploadInput = document.getElementById('imageUploadInput');
            const expandBtn = document.getElementById('expandBtn');
            const clearExpandBtn = document.getElementById('clearExpandBtn');
            const promptInput = document.getElementById('promptInput');
            const promptTemplate = document.getElementById('promptTemplate');
            const resetPromptTemplate = document.getElementById('resetPromptTemplate');
            const sendBtn = document.getElementById('sendBtn');
            const clearChatBtn = document.getElementById('clearChatBtn');
            const chatInput = document.getElementById('chatInput');
            const chatHistory = document.getElementById('chatHistory');
            const uploadArea = document.getElementById('uploadArea');
            const uploadContent = document.getElementById('uploadContent');
            const imageUpload = document.getElementById('imageUpload');
            const imagePreview = document.getElementById('imagePreview');
            const closePreview = document.getElementById('closePreview');
            const visionResponse = document.getElementById('visionResponse');
            const copyVisionBtn = document.getElementById('copyVisionBtn');
            const regenerateVisionBtn = document.getElementById('regenerateVisionBtn');
            const visionTemplate = document.getElementById('visionTemplate');
            const resetVisionTemplate = document.getElementById('resetVisionTemplate');
            const ttsInput = document.getElementById('ttsInput');
            const voiceSelect = document.getElementById('voiceSelect');
            const clearTtsBtn = document.getElementById('clearTtsBtn');
            const generateTtsBtn = document.getElementById('generateTtsBtn');
            const audioPlayer = document.getElementById('audioPlayer');
            const ttsAudio = document.getElementById('ttsAudio');
            const downloadTtsBtn = document.getElementById('downloadTtsBtn');
            
            promptTemplate.value = DEFAULT_PROMPT_TEMPLATE;
            visionTemplate.value = DEFAULT_VISION_TEMPLATE;
            
            clearChat();
            
            function setupEventListeners() {
                mainTabBtns.forEach(btn => btn.addEventListener('click', () => switchMainTab(btn)));
                secondaryTabBtns.forEach(btn => btn.addEventListener('click', () => switchSecondaryTab(btn)));
                expandBtn.addEventListener('click', handleExpandPrompt);
                clearExpandBtn.addEventListener('click', () => promptInput.value = '');
                resetPromptTemplate.addEventListener('click', () => promptTemplate.value = DEFAULT_PROMPT_TEMPLATE);
                promptInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); expandBtn.click(); }
                });
                sendBtn.addEventListener('click', handleSendMessage);
                clearChatBtn.addEventListener('click', clearChat);
                chatInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendBtn.click(); }
                });
                uploadImageBtn.addEventListener('click', () => imageUploadInput.click());
                imageUploadInput.addEventListener('change', handleImageUpload);
                document.getElementById('removeChatFile').addEventListener('click', () => {
                    document.getElementById('chatFilePreview').style.display = 'none';
                    document.getElementById('chatImagePreview').src = '';
                });
                uploadArea.addEventListener('click', () => imageUpload.click());
                imageUpload.addEventListener('change', handleVisionFileSelect);
                closePreview.addEventListener('click', resetVisionUpload);
                copyVisionBtn.addEventListener('click', copyVisionResult);
                regenerateVisionBtn.addEventListener('click', handleRegenerateVision);
                resetVisionTemplate.addEventListener('click', () => visionTemplate.value = DEFAULT_VISION_TEMPLATE);
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    uploadArea.addEventListener(eventName, preventDefaults, false);
                });
                ['dragenter', 'dragover'].forEach(eventName => {
                    uploadArea.addEventListener(eventName, () => uploadArea.classList.add('highlight'), false);
                });
                ['dragleave', 'drop'].forEach(eventName => {
                    uploadArea.addEventListener(eventName, () => uploadArea.classList.remove('highlight'), false);
                });
                uploadArea.addEventListener('drop', handleDrop, false);
                document.addEventListener('click', (e) => {
                    const copyBtn = e.target.closest('.copy-message-btn');
                    if (copyBtn) {
                        const messageContent = copyBtn.closest('.message-bubble').querySelector('.message-content').innerHTML;
                        const tempDiv = document.createElement('div');
                        tempDiv.innerHTML = messageContent;
                        navigator.clipboard.writeText(tempDiv.textContent || tempDiv.innerText).then(() => {
                            showAlert('已复制消息内容', 'success');
                        });
                    }
                });
                clearTtsBtn.addEventListener('click', () => {
                    ttsInput.value = '';
                    audioPlayer.style.display = 'none';
                });
                generateTtsBtn.addEventListener('click', handleGenerateTts);
                ttsInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); generateTtsBtn.click(); }
                });
            }
            
            function switchMainTab(clickedBtn) {
                mainTabBtns.forEach(b => b.classList.remove('active'));
                mainTabPanes.forEach(pane => pane.classList.remove('active'));
                clickedBtn.classList.add('active');
                const targetPane = document.getElementById(`${clickedBtn.dataset.tab}Tab`);
                if (targetPane) { targetPane.classList.add('active'); }
            }
            
            function switchSecondaryTab(clickedBtn) {
                const parentTabId = clickedBtn.dataset.parent;
                const relevantSecondaryBtns = document.querySelectorAll(`.secondary-tab-btn[data-parent="${parentTabId}"]`);
                const relevantSecondaryPanes = document.getElementById(`${parentTabId}Tab`).querySelectorAll('.secondary-tab-pane');
                relevantSecondaryBtns.forEach(b => b.classList.remove('active'));
                relevantSecondaryPanes.forEach(pane => pane.classList.remove('active'));
                clickedBtn.classList.add('active');
                const targetPane = document.getElementById(`${clickedBtn.dataset.subtab}SubTab`);
                if (targetPane) { targetPane.classList.add('active'); }
            }
            
            async function callTextApi(prompt) {
                if (!checkRequestFrequency()) return;
                try {
                    const encodedPrompt = encodeURIComponent(prompt);
                    const url = `https://text.pollinations.ai/${encodedPrompt}?model=openai`;
                    const response = await fetch(url);
                    if (!response.ok) { throw new Error(`API错误: ${response.status} - ${await response.text()}`); }
                    return await response.text();
                } catch (error) {
                    console.error('文本API请求失败:', error);
                    throw new Error(`请求失败: ${error.message}`);
                }
            }
            
            async function callVisionApi(imageBase64, template) {
                if (!checkRequestFrequency()) return;
                try {
                    const url = 'https://text.pollinations.ai/openai';
                    const payload = {
                        model: "openai",
                        messages: [{ role: "user", content: [{ type: "text", text: template }, { type: "image_url", image_url: { url: `data:image/jpeg;base64,${imageBase64}` } }] }],
                        max_tokens: 500
                    };
                    const response = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!response.ok) { const errorText = await response.text(); throw new Error(`API错误: ${response.status} - ${errorText}`); }
                    const data = await response.json();
                    return data.choices[0].message.content;
                } catch (error) {
                    console.error('视觉API请求失败:', error);
                    throw new Error(`请求失败: ${error.message}`);
                }
            }
            
            async function handleExpandPrompt() {
                const prompt = promptInput.value.trim();
                if (!prompt) return showAlert('请输入要扩写的提示词', 'error');
                setButtonLoading(expandBtn, true, '');
                try {
                    const expandedPrompt = await callTextApi(promptTemplate.value.replace('%s', prompt));
                    promptInput.value = expandedPrompt;
                    showAlert('提示词扩写完成！', 'success');
                } catch (error) {
                    showAlert(`扩写失败: ${error.message}`, 'error');
                } finally {
                    setButtonLoading(expandBtn, false, '<svg class="icon"><use xlink:href="#wand-magic-sparkles-solid-full"></use></svg>');
                }
            }
            
            async function handleImageUpload(e) {
                const file = e.target.files[0];
                if (!file) return;
                if (!file.type.startsWith('image/')) { showAlert('请上传图片文件', 'error'); return; }
                const preview = document.getElementById('chatFilePreview');
                const imagePreviewEl = document.getElementById('chatImagePreview');
                const fileIcon = document.getElementById('chatFileIcon');
                const fileName = document.getElementById('chatFilePreviewName');
                fileName.textContent = file.name;
                imagePreviewEl.style.display = 'block';
                fileIcon.style.display = 'none';
                const reader = new FileReader();
                reader.onload = (event) => {
                    imagePreviewEl.src = event.target.result;
                    preview.style.display = 'flex';
                };
                reader.readAsDataURL(file);
                imageUploadInput.value = '';
            }

            async function handleSendMessage() {
                const message = chatInput.value.trim();
                const chatImagePreview = document.getElementById('chatImagePreview');
                const hasImage = chatImagePreview.src && chatImagePreview.src.startsWith('data:image/');
                if (!message && !hasImage) return showAlert('请输入消息或上传图片', 'error');
                
                const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                let userMessageContent = message;
                let base64DataForApi = null;

                if (hasImage) {
                    const base64DataForDisplay = chatImagePreview.src;
                    base64DataForApi = base64DataForDisplay.split(',')[1];
                    userMessageContent += `<div class="message-file-attachment"><img src="${base64DataForDisplay}" alt="附件"><span>${document.getElementById('chatFilePreviewName').textContent}</span></div>`;
                }

                displayHistory.push({ role: 'user', content: userMessageContent, timestamp });
                renderChatHistory();

                chatInput.value = '';
                document.getElementById('chatFilePreview').style.display = 'none';
                chatImagePreview.src = '';
                document.getElementById('chatFilePreviewName').textContent = '';

                setButtonLoading(sendBtn, true, '');
                try {
                    let response;
                    if (hasImage && base64DataForApi) {
                        const question = message || "请详细描述这张图片。";
                        response = await callVisionApi(base64DataForApi, question);
                    } else {
                        response = await callTextApi(message);
                    }
                    const aiTimestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                    displayHistory.push({ role: 'ai', content: response, timestamp: aiTimestamp });
                    renderChatHistory();
                } catch (error) {
                    showAlert(`发送失败: ${error.message}`, 'error');
                } finally {
                    setButtonLoading(sendBtn, false, '<svg class="icon"><use xlink:href="#paper-plane-solid-full"></use></svg>');
                }
            }

            function clearChat() {
                apiHistory = [];
                displayHistory = [];
                displayHistory.push({
                    role: 'ai',
                    content: '<strong>您好 👏🏻😊<br>我是ChatGPT AI助手</strong><br><br>我可以为您答疑解惑，处理图像，转语音，完全免费使用！',
                    timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                    initial: true
                });
                renderChatHistory();
                showAlert('对话历史已清空', 'success');
            }
            
            async function handleVisionFileSelect(e) {
                const file = e.target.files[0];
                if (file) { visionUploadedFile = file; await processAndAnalyzeImage(file); }
            }
            
            async function handleRegenerateVision() {
                if (!visionUploadedFile) { showAlert('请先上传图片', 'error'); return; }
                await processAndAnalyzeImage(visionUploadedFile);
            }
            
            async function processAndAnalyzeImage(file) {
                const reader = new FileReader();
                reader.onload = async (event) => {
                    imagePreview.src = event.target.result;
                    imagePreview.style.display = 'block';
                    closePreview.style.display = 'flex';
                    uploadContent.style.display = 'none';
                    visionResponse.innerHTML = '正在分析图片...';
                    try {
                        const base64Image = event.target.result.split(',')[1];
                        const analysis = await callVisionApi(base64Image, visionTemplate.value);
                        visionResponse.innerHTML = marked.parse(analysis);
                        showAlert('图片分析完成！', 'success');
                    } catch (error) {
                        showAlert(`分析失败: ${error.message}`, 'error');
                        visionResponse.innerHTML = '分析失败，请重试。';
                    }
                };
                reader.readAsDataURL(file);
            }
            
            function resetVisionUpload(e) {
                if (e) e.stopPropagation();
                imagePreview.style.display = 'none';
                closePreview.style.display = 'none';
                imagePreview.src = '';
                imageUpload.value = '';
                uploadContent.style.display = 'block';
                visionResponse.innerHTML = '图片上传后将自动分析...';
                visionUploadedFile = null;
            }
            
            function copyVisionResult() {
                const text = visionResponse.innerText; 
                if (text && text !== '图片上传后将自动分析...') {
                    navigator.clipboard.writeText(text).then(() => showAlert('已复制到剪贴板！', 'success'));
                } else {
                    showAlert('没有可复制的内容', 'error');
                }
            }
            
            async function handleGenerateTts() {
                const text = ttsInput.value.trim();
                if (!text) return showAlert('请输入要转换的文本', 'error');
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    const voices = window.speechSynthesis.getVoices();
                    const selectedVoice = voices.find(v => v.name === voiceSelect.value) || voices[0];
                    utterance.voice = selectedVoice;
                    utterance.rate = 1.0;
                    utterance.pitch = 1.0;
                    window.speechSynthesis.speak(utterance);
                    showAlert('开始播放语音', 'success');
                } else {
                    showAlert('您的浏览器不支持语音合成功能', 'error');
                }
            }
            downloadTtsBtn.disabled = true;
            downloadTtsBtn.title = "当前浏览器不支持下载语音";
            
            function renderChatHistory() {
                chatHistory.innerHTML = '';
                const AVATARS = { user: "img/user.webp", ai: "img/2z.gif", initial: "img/2z.gif" };
                displayHistory.forEach(msg => {
                    const messageContainer = document.createElement('div');
                    messageContainer.className = `message ${msg.role}-message ${msg.initial ? 'initial' : ''}`;
                    let avatarSrc = msg.role === 'user' ? AVATARS.user : (msg.initial ? AVATARS.initial : AVATARS.ai);
                    let contentHTML = msg.role === 'user' ? msg.content : (msg.content ? marked.parse(msg.content) : 'AI没有返回有效的消息内容。');
                    messageContainer.innerHTML = `
                        <div class="message-avatar"><img src="${avatarSrc}" style="width: 40px;" alt="${msg.role}头像"></div>
                        <div class="message-bubble">
                            <div class="message-content">${contentHTML}</div>
                            <div class="message-footer">
                                <span class="message-time">${msg.timestamp}</span>
                                ${msg.role === 'ai' ? `<button class="copy-message-btn" title="复制"><svg class="icon" style="width:14px; height:14px;"><use xlink:href="#copy"></use></svg></button>` : ''}
                            </div>
                        </div>`;
                    chatHistory.appendChild(messageContainer);
                });
                chatHistory.scrollTop = chatHistory.scrollHeight;
            }
            
            function showAlert(message, type = 'success') {
                const alert = document.createElement('div');
                alert.className = `alert ${type}`;
                const iconId = type === 'success' ? 'circle-check-solid-full' : 'circle-exclamation-solid-full';
                alert.innerHTML = `<svg class="icon"><use xlink:href="#${iconId}"></use></svg> ${message}`;
                document.getElementById('alertContainer').appendChild(alert);
                setTimeout(() => alert.remove(), 3000);
            }
            
            function setButtonLoading(button, isLoading, loadingText) {
                button.disabled = isLoading;
                if (isLoading) {
                    button.classList.add('btn-disabled');
                    if (!button.dataset.originalContent) { button.dataset.originalContent = button.innerHTML; }
                    button.innerHTML = loadingText ? loadingText : `<span class="loader"></span>`;
                } else {
                    button.classList.remove('btn-disabled');
                    if(button.dataset.originalContent) { button.innerHTML = button.dataset.originalContent; button.dataset.originalContent = ''; }
                }
            }
            
            function preventDefaults(e) { e.preventDefault(); e.stopPropagation(); }
            
            function handleDrop(e) {
                let file = e.dataTransfer.files[0];
                if (file && file.type.startsWith('image/')) {
                    visionUploadedFile = file;
                    processAndAnalyzeImage(file);
                } else {
                    showAlert('AI视觉功能目前只支持图片上传', 'error');
                }
            }
            
            function checkRequestFrequency() {
                const now = Date.now();
                if (now - lastRequestTime < REQUEST_INTERVAL) {
                    showAlert('操作过于频繁，请稍后再试', 'error');
                    return false;
                }
                lastRequestTime = now;
                return true;
            }
            
            setupEventListeners();
        });
    </script>
</body>
</html>