<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI生成UI界面工具 - 智能设计原型图生成器</title>
    <!-- 添加Lucide图标库 -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script src="menu.js" defer></script>
  <link rel="icon" href="img/gongjuxiang.svg" type="image/svg">
  <script defer src="https://cloud.umami.is/script.js" data-website-id="5a2e10cd-bf73-47df-be48-079c9ba7783c" data-domains="designtool.site"></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3983418855272291"
     crossorigin="anonymous"></script>
    <style>
        :root {
            --main-color: #5a64ff;
            --btcolor: linear-gradient(113deg, #4c73ff, #6a52ff);
            --text1: #1a1d2e;
            --text2: #4a4e6d;
            --text3: #8d8fa3;
            --line: #e2e4f0;
            --bg: #f8f9ff;
            --card-bg: #ffffff;
            --shadow: rgba(149, 157, 165, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg);
            color: var(--text1);
            transition: background-color 0.3s, color 0.3s;
            min-height: 100vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
.device-icon {
    color: var(--text3);
    font-size: 1.2em;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
}
        .main-title {
            text-align: center;
            font-size: 1.6rem;
            color: var(--main-color);
	    margin-bottom: 10px;
        }
        p {
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
	color: var(--text2);
	}
	.set {
		color: var(--text3); 
		display: flex; 
		justify-content: flex-end;
		font-size: 18px;
		cursor: pointer;
		padding: 10px;
    		border-radius: 50%;
    		box-shadow: 0 0 10px var(--line);}
	.set:hover {
		color: var(--main-color);}
        .modification-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--main-color);
        }

        .container {
            display: flex;
            flex: 1;
            padding: 20px 20px 20px 80px;
            gap: 20px;
        }

        .left-panel {
            width: 460px;
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 24px;
            box-shadow: 0 8px 24px var(--shadow);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .right-panel {
            flex: 1;
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 24px;
            box-shadow: 0 8px 24px var(--shadow);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--line);
        }

        .controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .device-toggle {
            display: flex;
            background: linear-gradient(115deg, #f0edff, #dcedff);
            border-radius: 30px;
            padding: 4px;
            margin-bottom: 20px;
        }

        .device-option {
            flex: 1;
            padding: 8px 12px;
            text-align: center;
            border-radius: 30px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
	    color: var(--text2);
    	opacity: 0.8;
        }

        .device-option.active {
            background-color: var(--card-bg);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
	    opacity: 1;
        }
        
        .interface-settings {
            border-radius: 8px;
            padding: 16px 10px;
            margin-bottom: 20px;
	    gap: 20px;
    display: flex;
    flex-direction: column;
        }
        
        .settings-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text2);
        }
        
        .settings-row {
            display: flex;
            gap: 16px;
        }
        
        .setting-group {
            flex: 1;
        }
        
        .setting-label {
            font-size: 16px;
            color: var(--text1);
            margin-bottom: 10px;
            display: block;
	    font-weight: 600;
        }
        
        .interface-color {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .interface-color-input {
            width: 30px;
            height: 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        .color-hex-input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--line);
            border-radius: 8px;
            font-size: 14px;
            color: var(--text1);
            background-color: var(--card-bg);
        }
        
        .interface-mode-toggle {
            display: flex;
            border-radius: 30px;
	    gap: 8px;
        }
        
        .mode-option {
            flex: 1;
            padding: 6px 10px;
            text-align: center;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
	        border: 1px solid var(--line);
    		background: #fff;
	color: var(--text2);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
        }
        
        .mode-option.active {
            background-color: var(--card-bg);
            border: 1px solid var(--main-color);
	    color: var(--main-color);
        }

        .input-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .prompt-input {
            flex: 1;
            padding: 16px;
            border-radius: 8px;
            border: 1px solid var(--line);
            background-color: var(--bg);
            color: var(--text1);
            font-size: 16px;
            resize: none;
            outline: none;
            transition: border-color 0.3s;
        }
        .api-status {
	        color: #33b763;
	margin-bottom: 10px;
        }
        .prompt-input:focus {
            border-color: var(--main-color);
        }

        .action-buttons {
            display: flex;
            gap: 12px;
	    flex-direction: row-reverse;
        }

        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
	    width: 250px;
	margin: auto;
        }

        .generate-btn {
            background: #fff;
            color: var(--text2);
	z-index: 1;
    	position: absolute;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
        }

        .regenerate-btn {
            background-color: var(--card-bg);
            color: var(--main-color);
        }

        .regenerate-btn:hover {
            background-color: var(--bg);
            transform: translateY(-2px);
        }

        .preview-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
	        font-size: 18px;
            font-weight: 600;
            color: var(--text1);
        }

        .preview-header-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .header-btn {
            padding: 10px 15px;
            background: var(--card-bg);
            color: var(--text2);
            border: 1px solid var(--line);
            border-radius: 30px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }
        .header-btn:hover {
            background-color: var(--bg);
            color: var(--text1);
        }

        .preview-area {
	        display: flex;
            justify-content: center;
            align-items: center;
            flex: 1;
            background: radial-gradient(185% 30% at 100% 0%, #e6008100, #f9f9fe), linear-gradient(90deg, #D0EFFF, #d4dcff, #ffd9f2);
            border-radius: 8px;
            overflow: auto;
            padding: 20px;
        }
        
        .default-preview {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 16px;
            color: var(--text3);
            text-align: center;
        }

        /* [修复] 将选择器从 i 改为 svg，确保能正确选中并设置lucide.js生成的图标大小 */
        .default-preview svg {
            width: 80px;
            height: 80px;
        }

        .preview-content {
            overflow: auto;
            max-width: 100%;
            max-height: 100%;
            height: 100%; 
        }

        .mobile-view {

	        max-width: 100%;
    	    max-height: 80vh;
	        border: 10px solid;
            border-radius: 35px;
	    aspect-ratio: 9 / 19.5;
        }

        .pc-view {
            width: 100%;
            height: 90%;
	        border: 8px solid;
            border-radius: 14px;
        }

        .download-bt {
            padding: 10px 20px;
            background: var(--btcolor);
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .download-bt:hover {
            opacity: 0.9;
        }

        .loading {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 16px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(90, 100, 255, 0.2);
            border-top: 4px solid var(--main-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--text2);
            font-size: 16px;
        }

        .error-message {
            color: #ff4d4f;
            font-size: 16px;
            display: none;
        }

        .success-message {
            color: #52c41a;
            font-size: 16px;
            display: none;
        }

        /* 模型设置弹窗样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            width: 100%;
            max-width: 500px;
            overflow: hidden;
        }

        .modal-header {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text1);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text3);
            cursor: pointer;
            transition: color 0.2s;
        }

        .close-btn:hover {
            color: var(--text1);
        }

        .modal-body {
            padding: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text1);
        }

        .model-select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--line);
            border-radius: 8px;
            background: var(--bg);
            color: var(--text1);
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s;
            cursor: pointer;
        }

        .model-select:focus {
            border-color: var(--main-color);
        }

        .api-key-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--line);
            border-radius: 8px;
            background-color: var(--bg);
            color: var(--text1);
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s;
        }

        .api-key-input:focus {
            border-color: var(--main-color);
        }

        .api-key-container {
            margin-top: 15px;
            display: none;
        }

        .modal-footer {
            padding: 16px 24px;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .modal-btn {
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .cancel-btn {
            background-color: transparent;
            color: var(--text2);
            border: 1px solid var(--line);
        }

        .cancel-btn:hover {
            background-color: var(--bg);
        }

        .save-btn {
            background: var(--btcolor);
            color: white;
            border: none;
        }

        .save-btn:hover {
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .main-title {
                font-size: 24px;
                margin: 15px 0;
            }
	.settings-row { flex-direction: column;}
	.action-buttons {
	flex-direction: column;}
	.preview-header {
	flex-direction: column;}
            .container {
                flex-direction: column;
                padding: 0;
                gap: 15px;
            }

            .left-panel,
            .right-panel {
                width: 100%;
                padding: 15px;
            }

            .prompt-input {
                max-height: 120px;
            }

            .preview-area {
                padding: 10px;
	        flex-wrap: wrap;
	min-height: 50vh;
            }

            .preview-content {
                width: 100% !important;
                height: auto !important;
            }
            .mobile-view {
                width: 100%;
                height: auto;
                aspect-ratio: 9/16;
            }
            .preview-header-buttons {
	    margin-top: 10px;
            }
            .modal-content {
                width: 90%;
                max-width: none;
            }
        }
    </style>
</head>
<body>
<svg width="0" height="0" class="hidden">
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="arrows-to-dot-regular-full">
    <path d="M344 88C344 74.7 333.3 64 320 64C306.7 64 296 74.7 296 88L296 174.1L265 143.1C255.6 133.7 240.4 133.7 231.1 143.1C221.8 152.5 221.7 167.7 231.1 177L303.1 249C312.5 258.4 327.7 258.4 337 249L409 177C418.4 167.6 418.4 152.4 409 143.1C399.6 133.8 384.4 133.7 375.1 143.1L344.1 174.1L344.1 88zM497 409C506.4 399.6 506.4 384.4 497 375.1L466 344.1L552.1 344.1C565.4 344.1 576.1 333.4 576.1 320.1C576.1 306.8 565.4 296.1 552.1 296.1L466 296.1L497 265.1C506.4 255.7 506.4 240.5 497 231.2C487.6 221.9 472.4 221.8 463.1 231.2L391.1 303.2C381.7 312.6 381.7 327.8 391.1 337.1L463.1 409.1C472.5 418.5 487.7 418.5 497 409.1zM352 320C352 302.3 337.7 288 320 288C302.3 288 288 302.3 288 320C288 337.7 302.3 352 320 352C337.7 352 352 337.7 352 320zM177 231C167.6 221.6 152.4 221.6 143.1 231C133.8 240.4 133.7 255.6 143.1 264.9L174.1 295.9L88 295.9C74.7 295.9 64 306.6 64 319.9C64 333.2 74.7 343.9 88 343.9L174.1 343.9L143.1 374.9C133.7 384.3 133.7 399.5 143.1 408.8C152.5 418.1 167.7 418.2 177 408.8L249 336.8C258.4 327.4 258.4 312.2 249 302.9L177 230.9zM231 497C240.4 506.4 255.6 506.4 264.9 497L295.9 466L295.9 552.1C295.9 565.4 306.6 576.1 319.9 576.1C333.2 576.1 343.9 565.4 343.9 552.1L343.9 466L374.9 497C384.3 506.4 399.5 506.4 408.8 497C418.1 487.6 418.2 472.4 408.8 463.1L336.8 391.1C327.4 381.7 312.2 381.7 302.9 391.1L230.9 463.1C221.5 472.5 221.5 487.7 230.9 497z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="desktop-solid-full">
    <path d="M128 96C92.7 96 64 124.7 64 160L64 416C64 451.3 92.7 480 128 480L272 480L256 528L184 528C170.7 528 160 538.7 160 552C160 565.3 170.7 576 184 576L456 576C469.3 576 480 565.3 480 552C480 538.7 469.3 528 456 528L384 528L368 480L512 480C547.3 480 576 451.3 576 416L576 160C576 124.7 547.3 96 512 96L128 96zM160 160L480 160C497.7 160 512 174.3 512 192L512 352C512 369.7 497.7 384 480 384L160 384C142.3 384 128 369.7 128 352L128 192C128 174.3 142.3 160 160 160z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="download-solid-full">
    <path d="M352 96C352 78.3 337.7 64 320 64C302.3 64 288 78.3 288 96L288 306.7L246.6 265.3C234.1 252.8 213.8 252.8 201.3 265.3C188.8 277.8 188.8 298.1 201.3 310.6L297.3 406.6C309.8 419.1 330.1 419.1 342.6 406.6L438.6 310.6C451.1 298.1 451.1 277.8 438.6 265.3C426.1 252.8 405.8 252.8 393.3 265.3L352 306.7L352 96zM160 384C124.7 384 96 412.7 96 448L96 480C96 515.3 124.7 544 160 544L480 544C515.3 544 544 515.3 544 480L544 448C544 412.7 515.3 384 480 384L433.1 384L376.5 440.6C345.3 471.8 294.6 471.8 263.4 440.6L206.9 384L160 384zM464 440C477.3 440 488 450.7 488 464C488 477.3 477.3 488 464 488C450.7 488 440 477.3 440 464C440 450.7 450.7 440 464 440z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="gear-solid-full">
    <path d="M259.1 73.5C262.1 58.7 275.2 48 290.4 48L350.2 48C365.4 48 378.5 58.7 381.5 73.5L396 143.5C410.1 149.5 423.3 157.2 435.3 166.3L503.1 143.8C517.5 139 533.3 145 540.9 158.2L570.8 210C578.4 223.2 575.7 239.8 564.3 249.9L511 297.3C511.9 304.7 512.3 312.3 512.3 320C512.3 327.7 511.8 335.3 511 342.7L564.4 390.2C575.8 400.3 578.4 417 570.9 430.1L541 481.9C533.4 495 517.6 501.1 503.2 496.3L435.4 473.8C423.3 482.9 410.1 490.5 396.1 496.6L381.7 566.5C378.6 581.4 365.5 592 350.4 592L290.6 592C275.4 592 262.3 581.3 259.3 566.5L244.9 496.6C230.8 490.6 217.7 482.9 205.6 473.8L137.5 496.3C123.1 501.1 107.3 495.1 99.7 481.9L69.8 430.1C62.2 416.9 64.9 400.3 76.3 390.2L129.7 342.7C128.8 335.3 128.4 327.7 128.4 320C128.4 312.3 128.9 304.7 129.7 297.3L76.3 249.8C64.9 239.7 62.3 223 69.8 209.9L99.7 158.1C107.3 144.9 123.1 138.9 137.5 143.7L205.3 166.2C217.4 157.1 230.6 149.5 244.6 143.4L259.1 73.5zM320.3 400C364.5 399.8 400.2 363.9 400 319.7C399.8 275.5 363.9 239.8 319.7 240C275.5 240.2 239.8 276.1 240 320.3C240.2 364.5 276.1 400.2 320.3 400z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="image-solid-full">
    <path d="M160 96C124.7 96 96 124.7 96 160L96 480C96 515.3 124.7 544 160 544L480 544C515.3 544 544 515.3 544 480L544 160C544 124.7 515.3 96 480 96L160 96zM224 176C250.5 176 272 197.5 272 224C272 250.5 250.5 272 224 272C197.5 272 176 250.5 176 224C176 197.5 197.5 176 224 176zM368 288C376.4 288 384.1 292.4 388.5 299.5L476.5 443.5C481 450.9 481.2 460.2 477 467.8C472.8 475.4 464.7 480 456 480L184 480C175.1 480 166.8 475 162.7 467.1C158.6 459.2 159.2 449.6 164.3 442.3L220.3 362.3C224.8 355.9 232.1 352.1 240 352.1C247.9 352.1 255.2 355.9 259.7 362.3L286.1 400.1L347.5 299.6C351.9 292.5 359.6 288.1 368 288.1z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="mobile-screen-solid-full">
    <path d="M144 128C144 92.7 172.7 64 208 64L432 64C467.3 64 496 92.7 496 128L496 512C496 547.3 467.3 576 432 576L208 576C172.7 576 144 547.3 144 512L144 128zM256 504C256 517.3 266.7 528 280 528L360 528C373.3 528 384 517.3 384 504C384 490.7 373.3 480 360 480L280 480C266.7 480 256 490.7 256 504zM432 128L208 128L208 432L432 432L432 128z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="moon-regular-full">
    <path d="M303.3 112.7C196.2 121.2 112 210.8 112 320C112 434.9 205.1 528 320 528C353.3 528 384.7 520.2 412.6 506.3C309.2 482.9 232 390.5 232 280C232 214.2 259.4 154.9 303.3 112.7zM64 320C64 178.6 178.6 64 320 64C339.4 64 358.4 66.2 376.7 70.3C386.6 72.5 394 80.8 395.2 90.8C396.4 100.8 391.2 110.6 382.1 115.2C321.5 145.4 280 207.9 280 280C280 381.6 362.4 464 464 464C469 464 473.9 463.8 478.8 463.4C488.9 462.6 498.4 468.2 502.6 477.5C506.8 486.8 504.6 497.6 497.3 504.6C451.3 548.8 388.8 576 320 576C178.6 576 64 461.4 64 320z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="pen-to-square-solid-full">
    <path d="M535.6 85.7C513.7 63.8 478.3 63.8 456.4 85.7L432 110.1L529.9 208L554.3 183.6C576.2 161.7 576.2 126.3 554.3 104.4L535.6 85.7zM236.4 305.7C230.3 311.8 225.6 319.3 222.9 327.6L193.3 416.4C190.4 425 192.7 434.5 199.1 441C205.5 447.5 215 449.7 223.7 446.8L312.5 417.2C320.7 414.5 328.2 409.8 334.4 403.7L496 241.9L398.1 144L236.4 305.7zM160 128C107 128 64 171 64 224L64 480C64 533 107 576 160 576L416 576C469 576 512 533 512 480L512 384C512 366.3 497.7 352 480 352C462.3 352 448 366.3 448 384L448 480C448 497.7 433.7 512 416 512L160 512C142.3 512 128 497.7 128 480L128 224C128 206.3 142.3 192 160 192L256 192C273.7 192 288 177.7 288 160C288 142.3 273.7 128 256 128L160 128z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="rotate-right-solid-full">
    <path d="M552 256L408 256C398.3 256 389.5 250.2 385.8 241.2C382.1 232.2 384.1 221.9 391 215L437.7 168.3C362.4 109.7 253.4 115 184.2 184.2C109.2 259.2 109.2 380.7 184.2 455.7C259.2 530.7 380.7 530.7 455.7 455.7C463.9 447.5 471.2 438.8 477.6 429.6C487.7 415.1 507.7 411.6 522.2 421.7C536.7 431.8 540.2 451.8 530.1 466.3C521.6 478.5 511.9 490.1 501 501C401 601 238.9 601 139 501C39.1 401 39 239 139 139C233.3 44.7 382.7 39.4 483.3 122.8L535 71C541.9 64.1 552.2 62.1 561.2 65.8C570.2 69.5 576 78.3 576 88L576 232C576 245.3 565.3 256 552 256z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="sun-regular-full">
    <path d="M232.6 56.1C225.9 51.7 217.5 50.9 210.1 53.9C202.7 56.9 197.4 63.5 195.9 71.3L175 174.6L71.7 195.4C63.9 197 57.3 202.4 54.3 209.7C51.3 217 52.1 225.5 56.5 232.2L114.7 320L56.5 407.8C52.1 414.5 51.3 422.9 54.3 430.3C57.3 437.7 63.9 443.1 71.7 444.6L175 465.4L195.9 568.7C197.5 576.5 202.9 583.1 210.2 586.1C217.5 589.1 226 588.3 232.7 583.9L320.5 525.7L408.3 583.9C415 588.3 423.4 589.1 430.8 586.1C438.2 583.1 443.6 576.5 445.1 568.7L466 465.5L569.2 444.6C577 443 583.6 437.6 586.6 430.3C589.6 423 588.8 414.5 584.4 407.8L526.2 320L584.4 232.2C588.8 225.5 589.6 217.1 586.6 209.7C583.6 202.3 577 196.9 569.2 195.4L465.8 174.6L445 71.3C443.4 63.5 438 57 430.6 53.9C423.2 50.8 414.8 51.7 408.1 56.1L320.4 114.3L232.6 56.1zM218.9 199.7L235.9 115.8L307.2 163.1C315.2 168.4 325.7 168.4 333.7 163.1L405 115.8L422 199.7C423.9 209.2 431.3 216.5 440.8 218.5L524.7 235.5L477.4 306.8C472.1 314.8 472.1 325.3 477.4 333.3L524.7 404.6L440.8 421.6C431.3 423.5 423.9 430.9 422 440.4L405 524.3L333.7 477C325.7 471.7 315.2 471.7 307.2 477L235.9 524.3L218.9 440.4C217 430.9 209.6 423.5 200.1 421.6L116.2 404.6L163.5 333.3C168.8 325.3 168.8 314.8 163.5 306.8L116.2 235.5L200.1 218.5C209.6 216.6 216.9 209.2 218.9 199.7zM271.6 320C271.6 293.3 293.3 271.6 320 271.6C346.7 271.6 368.4 293.3 368.4 320C368.4 346.7 346.7 368.4 320 368.4C293.3 368.4 271.6 346.7 271.6 320zM416.4 320C416.4 266.8 373.2 223.6 320 223.6C266.8 223.6 223.6 266.8 223.6 320C223.6 373.2 266.8 416.4 320 416.4C373.2 416.4 416.4 373.2 416.4 320z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="table-columns-regular-full">
    <path d="M144 480L144 224L296 224L296 496L160 496C151.2 496 144 488.8 144 480zM344 496L344 224L496 224L496 480C496 488.8 488.8 496 480 496L344 496zM160 96C124.7 96 96 124.7 96 160L96 480C96 515.3 124.7 544 160 544L480 544C515.3 544 544 515.3 544 480L544 160C544 124.7 515.3 96 480 96L160 96z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="trash-can-solid-full">
    <path d="M232.7 69.9C237.1 56.8 249.3 48 263.1 48L377 48C390.8 48 403 56.8 407.4 69.9L416 96L512 96C529.7 96 544 110.3 544 128C544 145.7 529.7 160 512 160L128 160C110.3 160 96 145.7 96 128C96 110.3 110.3 96 128 96L224 96L232.7 69.9zM128 208L512 208L512 512C512 547.3 483.3 576 448 576L192 576C156.7 576 128 547.3 128 512L128 208zM216 272C202.7 272 192 282.7 192 296L192 488C192 501.3 202.7 512 216 512C229.3 512 240 501.3 240 488L240 296C240 282.7 229.3 272 216 272zM320 272C306.7 272 296 282.7 296 296L296 488C296 501.3 306.7 512 320 512C333.3 512 344 501.3 344 488L344 296C344 282.7 333.3 272 320 272zM424 272C410.7 272 400 282.7 400 296L400 488C400 501.3 410.7 512 424 512C437.3 512 448 501.3 448 488L448 296C448 282.7 437.3 272 424 272z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="wand-magic-sparkles-solid-full">
    <path d="M295.4 37L310.2 73.8L347 88.6C350 89.8 352 92.8 352 96C352 99.2 350 102.2 347 103.4L310.2 118.2L295.4 155C294.2 158 291.2 160 288 160C284.8 160 281.8 158 280.6 155L265.8 118.2L229 103.4C226 102.2 224 99.2 224 96C224 92.8 226 89.8 229 88.6L265.8 73.8L280.6 37C281.8 34 284.8 32 288 32C291.2 32 294.2 34 295.4 37zM142.7 105.7L164.2 155.8L214.3 177.3C220.2 179.8 224 185.6 224 192C224 198.4 220.2 204.2 214.3 206.7L164.2 228.2L142.7 278.3C140.2 284.2 134.4 288 128 288C121.6 288 115.8 284.2 113.3 278.3L91.8 228.2L41.7 206.7C35.8 204.2 32 198.4 32 192C32 185.6 35.8 179.8 41.7 177.3L91.8 155.8L113.3 105.7C115.8 99.8 121.6 96 128 96C134.4 96 140.2 99.8 142.7 105.7zM496 368C502.4 368 508.2 371.8 510.7 377.7L532.2 427.8L582.3 449.3C588.2 451.8 592 457.6 592 464C592 470.4 588.2 476.2 582.3 478.7L532.2 500.2L510.7 550.3C508.2 556.2 502.4 560 496 560C489.6 560 483.8 556.2 481.3 550.3L459.8 500.2L409.7 478.7C403.8 476.2 400 470.4 400 464C400 457.6 403.8 451.8 409.7 449.3L459.8 427.8L481.3 377.7C483.8 371.8 489.6 368 496 368zM492 64C503 64 513.6 68.4 521.5 76.2L563.8 118.5C571.6 126.4 576 137 576 148C576 159 571.6 169.6 563.8 177.5L475.6 265.7L374.3 164.4L462.5 76.2C470.4 68.4 481 64 492 64zM76.2 462.5L340.4 198.3L441.7 299.6L177.5 563.8C169.6 571.6 159 576 148 576C137 576 126.4 571.6 118.5 563.8L76.2 521.5C68.4 513.6 64 503 64 492C64 481 68.4 470.4 76.2 462.5z"></path>
  </symbol>
</svg>

    <!-- 模型设置弹窗 -->
    <div class="modal" id="modelSettingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">模型设置</h3>
                <button class="close-btn" id="closeModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">选择模型</label>
                    <select id="modelSelect" class="model-select">
                        <option value="free">免费无api版</option>
                        <option value="deepseek">DeepSeek API版</option>
                    </select>
                </div>
                
                <div id="apiKeyContainer" class="api-key-container">
                    <label class="form-label">DeepSeek API Key</label>
                    <input type="password" id="apiKeyInput" class="api-key-input" 
                           placeholder="请输入您的DeepSeek API密钥" autocomplete="off">
                    <p style="font-size: 14px; color: var(--text3); margin-top: 8px;">
                        DeepDeek比默认效果好，需自行申请和购买DeepSeek API。您的API密钥仅存储在本地浏览器中，不会上传到任何服务器
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel-btn" id="cancelBtn">取消</button>
                <button class="modal-btn save-btn" id="saveBtn">保存</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="left-panel">
            <div style="display: flex; justify-content: flex-end;">
		<div class="set" id="settingsBtn">	
		<svg class="icon"><use xlink:href="#gear-solid-full"></use></svg>
		</div>
	</div>
            <h1 class="main-title">AI生成UI界面</h1>
	<p>下载后的矢量文件可拖入sketch使用</p>
            <div class="device-toggle">
                <div class="device-option active" data-device="pc">PC端</div>
                <div class="device-option" data-device="mobile">移动端</div>
            </div>

            <div class="interface-settings">
                <div class="settings-row">
                    <div class="setting-group">
                        <label for="primaryColor" class="setting-label">主色调</label>
                        <div class="interface-color">
                            <input type="color" id="primaryColor" class="interface-color-input" value="#5a64ff">
                            <input type="text" id="primaryColorHex" class="color-hex-input" value="#5a64ff" maxlength="7">
                        </div>
                    </div>
                </div>
                <div class="settings-row">
                    <div class="setting-group">
                        <label for="interfaceMode" class="setting-label">界面模式</label>
                        <div class="interface-mode-toggle">
                            <div class="mode-option active" data-mode="light"><svg class="icon"><use xlink:href="#sun-regular-full"></use></svg>亮色</div>
                            <div class="mode-option" data-mode="dark"><svg class="icon"><use xlink:href="#moon-regular-full"></use></svg>暗色</div>
                        </div>
                    </div>
                    <div class="setting-group">
                        <label for="layoutStyle" class="setting-label">布局风格</label>
                        <div class="interface-mode-toggle">
                            <div class="mode-option active" data-layout="default"><svg class="icon"><use xlink:href="#table-columns-regular-full"></use></svg>默认</div>
                            <div class="mode-option" data-layout="compact"><svg class="icon"><use xlink:href="#arrows-to-dot-regular-full"></use></svg>紧凑</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="input-area">
                <h3 id="modificationTitle" class="modification-title" style="display: none;">输入修改要求</h3>
                <textarea id="promptInput" class="prompt-input" placeholder="请输入您想要生成的UI界面描述，例如：一个用户端登录界面。" rows="8"></textarea>
                <div class="action-buttons">
<div  style="width: 100%; display: flex; justify-content: center;">
		<button class="btn generate-btn" id="generateBtn">
                        <svg class="icon"><use xlink:href="#wand-magic-sparkles-solid-full"></use></svg>
                        生成
                    </button><button class="btn generate-btn" style="z-index: 0; position: relative; filter: blur(5px); background: linear-gradient(113deg, #6472ff, #42c1eb, #cc52ff);">
                        <use xlink:href="#wand-magic-sparkles-solid-full"></use></svg>
                        生成
                    </button></div>
                    <button class="btn regenerate-btn" id="regenerateBtn" style="display: none;">
                        <svg class="icon"><use xlink:href="#rotate-right-solid-full"></use></svg>
                        重新生成
                    </button>
                </div>
                <div class="api-status" id="apiStatus">API服务当前不可用，请稍后再试</div>
            </div>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3983418855272291"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:none"
     data-ad-format="fluid"
     data-ad-layout-key="-hq-18-1y-3r+o2"
     data-ad-client="ca-pub-3983418855272291"
     data-ad-slot="1924175279"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
        </div>

        <div class="right-panel">
            <div class="preview-container">
                <div class="preview-header">
                    <div style="display: flex; align-items: center; gap: 10px;flex-wrap: wrap; justify-content: center;">
        <div id="deviceIcon" class="device-icon">
           <svg class="icon"><use xlink:href="#desktop-solid-full"></use></svg>
        </div>
        <div id="previewDeviceName">PC端预览</div>
                <div id="errorMessage" class="error-message"></div>
                <div id="successMessage" class="success-message"></div>
		</div>
                    <div class="preview-header-buttons">
                        <button class="header-btn" id="clearBtn" style="display: none;">
                           <svg class="icon"><use xlink:href="#trash-can-solid-full"></use></svg>清空
                        </button>
                        <button class="header-btn" id="modifyBtn" style="display: none;">
                            <svg class="icon"><use xlink:href="#pen-to-square-solid-full"></use></svg>修改
                        </button>
                        <button class="download-bt" id="downloadBtn" disabled>
                            <svg class="icon" style="font-size: 1.2rem;"><use xlink:href="#download-solid-full"></use></svg>
                            下载矢量文件
                        </button>
                    </div>
                </div>
                <div class="preview-area" id="previewArea">
                    <div class="loading" id="loadingIndicator">
                        <div class="spinner"></div>
                        <div class="loading-text">生成中，请稍候...</div>
                    </div>
                    <div class="default-preview" id="defaultPreview">
                       <svg class="icon" style="font-size: 5rem; color: #d7d9e5;"><use xlink:href="#image-solid-full"></use></svg>
                        <p style="color: var(--text3);">在这里预览您生成的UI界面</p>
                    </div>
                    <div id="svgPreview" class="preview-content"></div>
                </div>
            </div>
        </div>
    </div>

    <script>

        // DOM元素引用
        const generateBtn = document.getElementById('generateBtn');
        const regenerateBtn = document.getElementById('regenerateBtn');
        const promptInput = document.getElementById('promptInput');
        const svgPreview = document.getElementById('svgPreview');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const defaultPreview = document.getElementById('defaultPreview');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');
        const downloadBtn = document.getElementById('downloadBtn');
        const apiStatus = document.getElementById('apiStatus');
        const deviceOptions = document.querySelectorAll('.device-toggle .device-option');
        const previewDeviceName = document.getElementById('previewDeviceName');
        const primaryColorInput = document.getElementById('primaryColor');
        const primaryColorHexInput = document.getElementById('primaryColorHex');
        const interfaceModeOptions = document.querySelectorAll('.interface-mode-toggle .mode-option[data-mode]');
        const layoutStyleOptions = document.querySelectorAll('.interface-mode-toggle .mode-option[data-layout]');
        // 新增DOM引用
        const modifyBtn = document.getElementById('modifyBtn');
        const clearBtn = document.getElementById('clearBtn');
        const modificationTitle = document.getElementById('modificationTitle');
        const settingsBtn = document.getElementById('settingsBtn');
        const modelSettingsModal = document.getElementById('modelSettingsModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const saveBtn = document.getElementById('saveBtn');
        const modelSelect = document.getElementById('modelSelect');
        const apiKeyInput = document.getElementById('apiKeyInput');
        const apiKeyContainer = document.getElementById('apiKeyContainer');

        // 状态变量
        let generatedSVG = '';
        let lastSuccessfulPrompt = ''; // 存储上次成功的prompt
        let isModificationMode = false; // 是否处于修改模式
        let currentDevice = 'pc';
        let currentInterfaceMode = 'light';
        let currentLayoutStyle = 'default';
        let currentPrimaryColor = '#5a64ff';
        let currentModel = 'free'; // 当前选择的模型
        let apiKey = ''; // 存储DeepSeek API密钥

        // 初始化
        function init() {
            hideMessages();
            updateApiStatus(true);
            
            // 从本地存储加载设置
            loadSettings();
            
            // 事件监听器
            generateBtn.addEventListener('click', () => generateSVG());
            regenerateBtn.addEventListener('click', () => generateSVG(lastSuccessfulPrompt)); // 传入上次的prompt
            downloadBtn.addEventListener('click', downloadSVG);
            modifyBtn.addEventListener('click', enterModificationMode);
            clearBtn.addEventListener('click', resetInterface);
            settingsBtn.addEventListener('click', openSettingsModal);
            closeModalBtn.addEventListener('click', closeSettingsModal);
            cancelBtn.addEventListener('click', closeSettingsModal);
            saveBtn.addEventListener('click', saveSettings);
            
            // 模型选择变化事件
            modelSelect.addEventListener('change', () => {
                if (modelSelect.value === 'deepseek') {
                    apiKeyContainer.style.display = 'block';
                } else {
                    apiKeyContainer.style.display = 'none';
                }
            });

            deviceOptions.forEach(option => {
                option.addEventListener('click', () => {
                    deviceOptions.forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                    currentDevice = option.dataset.device;
                    previewDeviceName.textContent = `${option.textContent}预览`;
			updateDeviceIcon();
                    updatePreviewSize();
                });
            });
// 新增：设备图标更新函数
function updateDeviceIcon() {
    const deviceIcon = document.getElementById('deviceIcon');
    if (currentDevice === 'pc') {
        deviceIcon.innerHTML = '<svg class="icon"><use xlink:href="#desktop-solid-full"></use></svg>';
    } else {
        deviceIcon.innerHTML = '<svg class="icon"><use xlink:href="#mobile-screen-solid-full"></use></svg>';
    }
}
// 在 init() 函数末尾添加初始图标设置
updateDeviceIcon(); // 确保初始状态正确
            primaryColorInput.addEventListener('input', (e) => {
                currentPrimaryColor = e.target.value;
                primaryColorHexInput.value = currentPrimaryColor;
            });

            primaryColorHexInput.addEventListener('input', (e) => {
                let value = e.target.value.trim();
                if (/^#([0-9A-Fa-f]{3}){1,2}$/.test(value)) {
                    currentPrimaryColor = value;
                    primaryColorInput.value = currentPrimaryColor;
                }
            });

            interfaceModeOptions.forEach(option => option.addEventListener('click', () => {
                interfaceModeOptions.forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
                currentInterfaceMode = option.dataset.mode;
            }));

            layoutStyleOptions.forEach(option => option.addEventListener('click', () => {
                layoutStyleOptions.forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
                currentLayoutStyle = option.dataset.layout;
            }));
            
            primaryColorHexInput.value = primaryColorInput.value;
        }
        
        // 从本地存储加载设置
        function loadSettings() {
            const savedModel = localStorage.getItem('aiModel');
            const savedApiKey = localStorage.getItem('deepseekApiKey');
            
            if (savedModel) {
                currentModel = savedModel;
                modelSelect.value = savedModel;
                
                if (savedModel === 'deepseek') {
                    apiKeyContainer.style.display = 'block';
                    if (savedApiKey) {
                        apiKey = savedApiKey;
                        apiKeyInput.value = savedApiKey;
                    }
                }
            }
        }
        
        // 保存设置到本地存储
        function saveSettings() {
            currentModel = modelSelect.value;
            
            if (currentModel === 'deepseek') {
                apiKey = apiKeyInput.value.trim();
                if (!apiKey) {
                    alert('请输入DeepSeek API密钥');
                    return;
                }
                localStorage.setItem('deepseekApiKey', apiKey);
            }
            
            localStorage.setItem('aiModel', currentModel);
            closeSettingsModal();
            alert('设置已保存！');
        }
        
        // 打开设置弹窗
        function openSettingsModal() {
            modelSettingsModal.style.display = 'flex';
        }
        
        // 关闭设置弹窗
        function closeSettingsModal() {
            modelSettingsModal.style.display = 'none';
            // 重置表单到当前设置
            modelSelect.value = currentModel;
            if (currentModel === 'deepseek') {
                apiKeyContainer.style.display = 'block';
                apiKeyInput.value = apiKey;
            } else {
                apiKeyContainer.style.display = 'none';
            }
        }
        
        // 重置整个界面
        function resetInterface() {
            svgPreview.innerHTML = '';
            defaultPreview.style.display = 'flex';
            
            promptInput.value = '';
            promptInput.placeholder = '请输入您想要生成的UI界面描述，例如：一个用户端登录界面。';
            
            hideMessages();
            downloadBtn.disabled = true;
            modifyBtn.style.display = 'none';
            clearBtn.style.display = 'none';
            regenerateBtn.style.display = 'none';
            modificationTitle.style.display = 'none';

            isModificationMode = false;
            generatedSVG = '';
            lastSuccessfulPrompt = '';
        }

        // 进入修改模式
        function enterModificationMode() {
            isModificationMode = true;
            modificationTitle.style.display = 'block';
            promptInput.value = '';
            promptInput.placeholder = '例如：把所有按钮都变成圆形，背景换成深蓝色。';
            promptInput.focus();
        }

        function updateApiStatus(isActive) {
            if (isActive) {
                apiStatus.textContent = 'API服务可用';
                apiStatus.style.color = '#33b763';
            } else {
                apiStatus.textContent = 'API服务当前不可用，请稍后再试';
                apiStatus.style.color = '#ff4d4f';
            }
        }

        function updatePreviewSize() {
            const previewWrapper = svgPreview.querySelector('div');
            if (previewWrapper) {
                previewWrapper.classList.remove('pc-view', 'mobile-view');
                previewWrapper.classList.add(currentDevice === 'mobile' ? 'mobile-view' : 'pc-view');
            }
            const svgElement = previewWrapper ? previewWrapper.querySelector('svg') : null;
            if (svgElement) {
                svgElement.setAttribute('width', '100%');
                svgElement.setAttribute('height', '100%');
            }
        }

        async function generateSVG(promptOverride = null) {
            // 通过判断是否存在promptOverride来确定这是否是一次"重新生成"操作
            const isRegeneration = promptOverride !== null;
            const prompt = promptOverride ?? promptInput.value.trim();
            
            if (!prompt) {
                showError(isModificationMode ? '请输入修改要求。' : '请输入UI界面描述。');
                return;
            }

            hideMessages();
            loadingIndicator.style.display = 'flex';
            defaultPreview.style.display = 'none';
            regenerateBtn.style.display = 'none';
            modifyBtn.style.display = 'none';
            clearBtn.style.display = 'none';
            downloadBtn.disabled = true;
            svgPreview.innerHTML = '';

            try {
                let fullPrompt;

                if (isModificationMode) {
                    fullPrompt = `请基于以下现有的SVG代码，并根据用户的修改要求，生成一个新的完整、有效、可预览的SVG代码。请仅返回SVG代码本身，不要包含任何其他说明文字或Markdown代码块标记。\n\n【现有SVG代码】:\n${generatedSVG}\n\n【修改要求】:\n${prompt}\n\n【其他设计参数】:\n设备: ${currentDevice}, 主色调: ${currentPrimaryColor}, 界面模式: ${currentInterfaceMode}, 布局风格: ${currentLayoutStyle}。请继续使用Lucide图标库和picsum.photos图片库。`;
                } else {
                    // 如果是重新生成，在prompt中加入额外指令以确保API返回新的、不同的结果
                    const regenerationHint = isRegeneration ? '请为我生成一个不同于上一个的、全新的、有创意的版本。' : '';
                    fullPrompt = `生成一个完整、有效、可预览的SVG代码，仅返回SVG代码本身，不要包含任何HTML、CSS、JS、解释性文字或Markdown代码块标记。确保SVG是独立且可直接嵌入的。描述：${prompt}。${regenerationHint}设备：${currentDevice}，主色调：${currentPrimaryColor}，界面模式：${currentInterfaceMode}，布局风格：${currentLayoutStyle}，引入开源图片库picsum.photos进行随机填充, 使用Lucide图标库进行填充。`;
                }
                
                let response;
                let text;
                
                // 根据选择的模型使用不同的API
                if (currentModel === 'free') {
                    const POLLINATIONS_API_URL = 'https://text.pollinations.ai/';
                    response = await fetch(`${POLLINATIONS_API_URL}${encodeURIComponent(fullPrompt)}`);
                    
                    if (!response.ok) throw new Error(`免费API请求失败，状态码: ${response.status}`);
                    
                    text = await response.text();
                } else if (currentModel === 'deepseek') {
                    if (!apiKey) {
                        throw new Error('请先在设置中配置DeepSeek API密钥');
                    }
                    
                    const DEEPSEEK_API_URL = 'https://api.deepseek.com/v1/chat/completions';
                    response = await fetch(DEEPSEEK_API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: "deepseek-chat",
                            messages: [
                                { role: "user", content: fullPrompt }
                            ],
                            temperature: 0.7,
                            max_tokens: 2000
                        })
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(`DeepSeek API请求失败: ${errorData.error?.message || '未知错误'}`);
                    }
                    
                    const data = await response.json();
                    text = data.choices[0]?.message?.content || '';
                }
                
                const svgMatch = text.match(/<svg.*?>[\s\S]*?<\/svg>/i);
                
                const newSVG = svgMatch ? svgMatch[0].trim() : text.trim();

                if (newSVG && newSVG.startsWith('<svg')) {
                    generatedSVG = newSVG; // 更新当前SVG
                    const svgWrapper = document.createElement('div');
                    svgWrapper.style.display = 'flex';
                    svgWrapper.style.justifyContent = 'center';
                    svgWrapper.style.alignItems = 'center';
                    svgWrapper.style.overflow = 'auto';
                    svgPreview.appendChild(svgWrapper);
                    svgWrapper.innerHTML = generatedSVG;

                    const svgElement = svgWrapper.querySelector('svg');
                    if (svgElement) {
                        svgElement.setAttribute('width', '100%');
                        svgElement.setAttribute('height', '100%');
                        updatePreviewSize();
                    }

                    showSuccess('生成成功！');
                    downloadBtn.disabled = false;
                    regenerateBtn.style.display = 'flex';
                    modifyBtn.style.display = 'flex';
                    clearBtn.style.display = 'flex';
                    updateApiStatus(true);

                    // 成功后退出修改模式，并记录成功的prompt
                    if (isModificationMode) {
                        isModificationMode = false;
                        modificationTitle.style.display = 'none';
                        promptInput.value = ''; // 清空修改指令
                        promptInput.placeholder = '请输入您想要生成的UI界面描述，例如：一个用户端登录界面。';
                    }
                    // 只在不是修改模式（即初始生成或重新生成）时更新lastSuccessfulPrompt
                    if (!isModificationMode) {
                        lastSuccessfulPrompt = prompt;
                    }

                } else {
                    showError('API返回了空或无效的SVG内容。请尝试更具体的描述。');
                    defaultPreview.style.display = 'flex';
                    updateApiStatus(false);
                }

            } catch (error) {
                console.error('生成SVG时发生错误:', error);
                showError(`生成失败: ${error.message}`);
                defaultPreview.style.display = 'flex';
                updateApiStatus(false);
            } finally {
                loadingIndicator.style.display = 'none';
            }
        }
        
        function downloadSVG() {
            if (!generatedSVG) return;
            const blob = new Blob([generatedSVG], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ai-interface-${new Date().getTime()}.svg`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            successMessage.style.display = 'none';
        }
        
        function showSuccess(message) {
            successMessage.textContent = message;
            successMessage.style.display = 'block';
            errorMessage.style.display = 'none';
        }
        
        function hideMessages() {
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
        }
        
        init();
    </script>
</body>
</html>