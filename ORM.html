<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORM贴图合成与拆解工具 - 金属度/粗糙度/环境光遮蔽/透明度处理</title>
    <script src="https://cdn.jsdelivr.net/npm/utif@3.1.0/UTIF.min.js"></script>
 <script src="menu.js" defer></script>
    <link rel="icon" href="img/gongjuxiang.svg" type="image/svg">
<script defer src="https://cloud.umami.is/script.js" data-website-id="5a2e10cd-bf73-47df-be48-079c9ba7783c" data-domains="designtool.site"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        :root {
            --main-color: #8080FF;
            --bg-background: #18161e;
            --btcolor: linear-gradient(to left, #6450ff, #8f56fa);
            --text1: #fff;
            --text2: #c7d1e2;
            --text3: #969dbb;
            --line: #7878784d;
            --mainbg: #2c2c30;
            --shadow: #8080ff2b;
            --bg2: #0003;
            --decompose-bg: rgba(255, 140, 0, 0.1);
            --decompose-color: #ff8c00;
            --hover-color: rgba(128, 128, 255, 0.25);
            --success: #32c832;
            --warning: #ff8c00;
            --error: #ff3232;
            --alpha-color: #8a2be2;
        }
        body {
            background: #1a1b1c;
            color: #fff;
            min-height: 100vh;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow-x: hidden;
        }
        .icon {
    display: inline-block;
    width: 1.2em;
    height: 1.2em;
    fill: currentColor;
}
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            position: relative;
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: var(--main-color);
            position: relative;
            display: inline-block;
            margin-top: 20px;
        }
        
        .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto 20px;
            line-height: 1.6;
            color: var(--text3);
        }
        
        .features {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin: 25px 0;
        }
        
        .feature {
            background: rgba(128, 128, 255, 0.15);
            border-radius: 20px;
            padding: 10px 20px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.3s, background 0.3s;
        }
        
        .feature:hover {
            transform: translateY(-3px);
            background: rgba(128, 128, 255, 0.25);
        }
        
        .feature i {
            color: var(--main-color);
            font-size: 1.2rem;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .upload-section, .preview-section {
            flex: 1;
            min-width: 300px;
            background: var(--mainbg);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(128, 128, 255, 0.1);
        }
        
        .preview-section {
            display: flex;
            flex-direction: column;
        }
        
        .section-title {
            font-size: 1.1rem;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--line);
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text1);
        }
        
        .section-title i {
            color: var(--main-color);
            font-size: 1.4rem;
        }
        
        .upload-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
	margin-bottom: 10px;
        }
        
        .upload-box {
            background: var(--bg-background);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px dashed var(--line);
            position: relative;
            height: 260px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;       
        }
        
        .upload-box.drag-over {
            background: rgba(79, 172, 254, 0.2);
            border-color: #4facfe;
            transform: scale(1.02);
        }
        
        .upload-icon {
            font-size: 3.5rem;
            margin-bottom: 15px;
            color: #4facfe;
        }
        
        .upload-text {
            margin-bottom: 15px;
            font-size: 1rem;
            padding: 0 10px;
        }
        
        .upload-box input {
            display: none;
        }
        
        .channel-label {
            display: flex;
            padding: 6px 18px;
            border-radius: 20px;
            font-size: 1rem;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.1);
            margin-bottom: 8px;
        }

        
        .preview-img {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 2;
            cursor: pointer;
        }
        
        .preview-img img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            transition: transform 0.3s;
        }
        
        .preview-img:hover img {
            transform: scale(1.05);
        }
        
        .preview-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            font-size: 14px;
            text-align: center;
            z-index: 3;
            display: flex;
            justify-content: flex-end;
            align-items: center;
        }
        
        .delete-btn {
            background: rgba(255, 50, 50, 0.6);
            color: white;
            border: none;
            border-radius: 0 8px 0 24px;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 4;
            font-size: 1rem;
            padding-left: 4px;
            padding-bottom: 4px;
        }
        
        .delete-btn:hover {
            background: rgba(255, 50, 50, 0.9);
            transform: scale(1.1);
        }
        
        .download-bt {
            position: absolute;
            right: 10px;
            bottom: 10px;
            width: 32px;
            height: 32px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s;
            opacity: 0.7;
	    align-content: center;
        }
        
        .download-bt:hover {
            opacity: 1;
            background: rgba(50, 200, 50, 0.8);
            transform: scale(1.1);
        }
        
        .result-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-around;
            border-radius: 10px;
            position: relative;
            min-height: 400px;
        }
        
        .decompose-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 5;
            border-radius: 12px;
            border: 2px dashed var(--main-color);
        }
        
        .decompose-icon {
            font-size: 3rem;
            color: var(--main-color);
            margin-bottom: 20px;
        }
        
        .decompose-text {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #fff;
            font-weight: 600;
        }
        
        .decompose-hint {
            font-size: 1rem;
            color: var(--text3);
            max-width: 320px;
            line-height: 1.5;
        }
        
        .result-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--text3);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .result-img {
            width: 100%;
            height: 540px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            border: 2px solid rgba(255,255,255,0.1);
            cursor: pointer;
            position: relative;
        }
        
        .result-img img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            transition: transform 0.3s;
        }
        
        .result-img:hover img {
            transform: scale(1.05);
        }
        
        .btn {
            background: var(--btcolor);
            color: white;
            border: none;
            padding: 14px 25px;
            font-size: 16px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-shadow: 0 0 3px #00000073;
            justify-content: center;
        }
        
        .upload-btn {
            width: 180px;
            background: rgba(128, 128, 255, 0.2);
            border: 1px solid var(--main-color);
            padding: 10px;
        }
        
        .upload-btn:hover {
            background: rgba(128, 128, 255, 0.4);
        }
        
        .decompose-btn {
            background: var(--main-color);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px var(--shadow);
        }
        
        .btn:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn i {
            font-size: 1.05rem;
        }
        
        .instructions {
            background: var(--mainbg);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid rgba(128, 128, 255, 0.1);
        }
        
        .instructions h2 {
            margin-bottom: 20px;
            color: #fff;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .instructions h2 i {
            color: var(--main-color);
        }
        
        .instructions ul {
            padding-left: 25px;
            font-size: 1rem;
            color: var(--text3);
            line-height: 1.7;
        }
        
        .instructions li {
            margin-bottom: 12px;
        }
        
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: 500;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        
        .status.ready {
            background: rgba(50, 200, 50, 0.15);
            color: var(--success);
            border: 1px solid rgba(50, 200, 50, 0.3);
        }
        
        .status.waiting {
            background: rgba(200, 180, 50, 0.15);
            color: #c8b432;
            border: 1px solid rgba(200, 180, 50, 0.3);
        }
        
        .status.processing {
            background: rgba(50, 100, 255, 0.15);
            color: #4facfe;
            border: 1px solid rgba(50, 100, 255, 0.3);
        }
        
        .status.decompose {
            background: rgba(255, 140, 0, 0.15);
            color: var(--decompose-color);
            border: 1px solid rgba(255, 140, 0, 0.3);
        }
        
        .status.error {
            background: rgba(255, 50, 50, 0.15);
            color: var(--error);
            border: 1px solid rgba(255, 50, 50, 0.3);
        }
        
        .upload-hint {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1;
            text-align: center;
            width: 100%;
            padding: 20px;
            transition: opacity 0.3s;
        }
        
        .drag-text {
            display: block;
            margin-top: 10px;
            font-size: 0.95rem;
            color: var(--text3);
            font-weight: bold;
            opacity: 0.8;
        }
        
        .action-buttons {
            display: flex;
            align-items: center;
            width: 100%;
            margin-top: 10px;
            justify-content: space-around;
            flex-direction: row;
            gap: 15px;
        }
        
        .orm-upload-btn {
            background: rgba(128, 128, 255, 0.2);
            border: 1px solid var(--main-color);
        }
        
        .orm-upload-btn:hover {
            background: rgba(128, 128, 255, 0.4);
            box-shadow: 0 6px 20px var(--shadow);
        }
        
        .format-support {
            text-align: center;
            font-size: 0.9rem;
            color: var(--text3);
	    font-weight: 400;
        }
        
        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            box-shadow: 0 0 30px rgba(128, 128, 255, 0.3);
            border-radius: 5px;
        }
        
        .modal-close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
            opacity: 0.7;
        }
        
        .modal-close:hover {
            color: #4facfe;
            opacity: 1;
        }
        
        .bg-pattern {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 10% 20%, rgba(128, 128, 255, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 140, 0, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 30% 70%, rgba(138, 43, 226, 0.05) 0%, transparent 20%);
            pointer-events: none;
            z-index: -1;
        }
        
        .channel-indicator {
            display: inline-block;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            margin-right: 8px;
            vertical-align: middle;
        }
        
        .ao-indicator { background: #5f2125; }
        .roughness-indicator { background: #285c29; }
        .metallic-indicator { background: #222d61; }
        .alpha-indicator { background: #8a2be2; }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
	.upload-box {
	    height: 182px;}
	.result-img {height: 384px;}
            .instructions {
                padding: 14px;
            }
            .upload-container {
            }
            
            .modal-close {
                top: 10px;
                right: 15px;
                font-size: 30px;
            }
            
            .features {
                flex-direction: column;
                align-items: center;
            }
            .container {
                padding: 10px;
            }
            .upload-section, .preview-section {
                padding: 14px;
            }
            .btn {
                width: 100%;
                max-width: 300px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
<svg width="0" height="0" class="hidden">
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="circle-exclamation-solid-full">
    <path d="M320 576C178.6 576 64 461.4 64 320C64 178.6 178.6 64 320 64C461.4 64 576 178.6 576 320C576 461.4 461.4 576 320 576zM320 384C302.3 384 288 398.3 288 416C288 433.7 302.3 448 320 448C337.7 448 352 433.7 352 416C352 398.3 337.7 384 320 384zM320 192C301.8 192 287.3 207.5 288.6 225.7L296 329.7C296.9 342.3 307.4 352 319.9 352C332.5 352 342.9 342.3 343.8 329.7L351.2 225.7C352.5 207.5 338.1 192 319.8 192z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="cloud-arrow-up-solid-full">
    <path d="M176 544C96.5 544 32 479.5 32 400C32 336.6 73 282.8 129.9 263.5C128.6 255.8 128 248 128 240C128 160.5 192.5 96 272 96C327.4 96 375.5 127.3 399.6 173.1C413.8 164.8 430.4 160 448 160C501 160 544 203 544 256C544 271.7 540.2 286.6 533.5 299.7C577.5 320 608 364.4 608 416C608 486.7 550.7 544 480 544L176 544zM337 255C327.6 245.6 312.4 245.6 303.1 255L231.1 327C221.7 336.4 221.7 351.6 231.1 360.9C240.5 370.2 255.7 370.3 265 360.9L296 329.9L296 432C296 445.3 306.7 456 320 456C333.3 456 344 445.3 344 432L344 329.9L375 360.9C384.4 370.3 399.6 370.3 408.9 360.9C418.2 351.5 418.3 336.3 408.9 327L336.9 255z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="cube-solid-full">
    <path d="M288.3 61.5C308.1 50.1 332.5 50.1 352.3 61.5L528.2 163C548 174.4 560.2 195.6 560.2 218.4L560.2 421.4C560.2 444.3 548 465.4 528.2 476.8L352.3 578.5C332.5 589.9 308.1 589.9 288.3 578.5L112.5 477C92.7 465.6 80.5 444.4 80.5 421.6L80.5 218.6C80.5 195.7 92.7 174.6 112.5 163.2L288.3 61.5zM496.1 421.5L496.1 255.4L352.3 338.4L352.3 504.5L496.1 421.5z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="download-solid-full">
    <path d="M352 96C352 78.3 337.7 64 320 64C302.3 64 288 78.3 288 96L288 306.7L246.6 265.3C234.1 252.8 213.8 252.8 201.3 265.3C188.8 277.8 188.8 298.1 201.3 310.6L297.3 406.6C309.8 419.1 330.1 419.1 342.6 406.6L438.6 310.6C451.1 298.1 451.1 277.8 438.6 265.3C426.1 252.8 405.8 252.8 393.3 265.3L352 306.7L352 96zM160 384C124.7 384 96 412.7 96 448L96 480C96 515.3 124.7 544 160 544L480 544C515.3 544 544 515.3 544 480L544 448C544 412.7 515.3 384 480 384L433.1 384L376.5 440.6C345.3 471.8 294.6 471.8 263.4 440.6L206.9 384L160 384zM464 440C477.3 440 488 450.7 488 464C488 477.3 477.3 488 464 488C450.7 488 440 477.3 440 464C440 450.7 450.7 440 464 440z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="gears-solid-full">
    <path d="M415.9 274.5C428.1 271.2 440.9 277 446.4 288.3L465 325.9C475.3 327.3 485.4 330.1 494.9 334L529.9 310.7C540.4 303.7 554.3 305.1 563.2 314L582.4 333.2C591.3 342.1 592.7 356.1 585.7 366.5L562.4 401.4C564.3 406.1 566 411 567.4 416.1C568.8 421.2 569.7 426.2 570.4 431.3L608.1 449.9C619.4 455.5 625.2 468.3 621.9 480.4L614.9 506.6C611.6 518.7 600.3 526.9 587.7 526.1L545.7 523.4C539.4 531.5 532.1 539 523.8 545.4L526.5 587.3C527.3 599.9 519.1 611.3 507 614.5L480.8 621.5C468.6 624.8 455.9 619 450.3 607.7L431.7 570.1C421.4 568.7 411.3 565.9 401.8 562L366.8 585.3C356.3 592.3 342.4 590.9 333.5 582L314.3 562.8C305.4 553.9 304 540 311 529.5L334.3 494.5C332.4 489.8 330.7 484.9 329.3 479.8C327.9 474.7 327 469.6 326.3 464.6L288.6 446C277.3 440.4 271.6 427.6 274.8 415.5L281.8 389.3C285.1 377.2 296.4 369 309 369.8L350.9 372.5C357.2 364.4 364.5 356.9 372.8 350.5L370.1 308.7C369.3 296.1 377.5 284.7 389.6 281.5L415.8 274.5zM448.4 404C424.1 404 404.4 423.7 404.5 448.1C404.5 472.4 424.2 492 448.5 492C472.8 492 492.5 472.3 492.5 448C492.4 423.6 472.7 404 448.4 404zM224.9 18.5L251.1 25.5C263.2 28.8 271.4 40.2 270.6 52.7L267.9 94.5C276.2 100.9 283.5 108.3 289.8 116.5L331.8 113.8C344.3 113 355.7 121.2 359 133.3L366 159.5C369.2 171.6 363.5 184.4 352.2 190L314.5 208.6C313.8 213.7 312.8 218.8 311.5 223.8C310.2 228.8 308.4 233.8 306.5 238.5L329.8 273.5C336.8 284 335.4 297.9 326.5 306.8L307.3 326C298.4 334.9 284.5 336.3 274 329.3L239 306C229.5 309.9 219.4 312.7 209.1 314.1L190.5 351.7C184.9 363 172.1 368.7 160 365.5L133.8 358.5C121.6 355.2 113.5 343.8 114.3 331.3L117 289.4C108.7 283 101.4 275.6 95.1 267.4L53.1 270.1C40.6 270.9 29.2 262.7 25.9 250.6L18.9 224.4C15.7 212.3 21.4 199.5 32.7 193.9L70.4 175.3C71.1 170.2 72.1 165.2 73.4 160.1C74.8 155 76.4 150.1 78.4 145.4L55.1 110.5C48.1 100 49.5 86.1 58.4 77.2L77.6 58C86.5 49.1 100.4 47.7 110.9 54.7L145.9 78C155.4 74.1 165.5 71.3 175.8 69.9L194.4 32.3C200 21 212.7 15.3 224.9 18.5zM192.4 148C168.1 148 148.4 167.7 148.4 192C148.4 216.3 168.1 236 192.4 236C216.7 236 236.4 216.3 236.4 192C236.4 167.7 216.7 148 192.4 148z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="image-solid-full">
    <path d="M160 96C124.7 96 96 124.7 96 160L96 480C96 515.3 124.7 544 160 544L480 544C515.3 544 544 515.3 544 480L544 160C544 124.7 515.3 96 480 96L160 96zM224 176C250.5 176 272 197.5 272 224C272 250.5 250.5 272 224 272C197.5 272 176 250.5 176 224C176 197.5 197.5 176 224 176zM368 288C376.4 288 384.1 292.4 388.5 299.5L476.5 443.5C481 450.9 481.2 460.2 477 467.8C472.8 475.4 464.7 480 456 480L184 480C175.1 480 166.8 475 162.7 467.1C158.6 459.2 159.2 449.6 164.3 442.3L220.3 362.3C224.8 355.9 232.1 352.1 240 352.1C247.9 352.1 255.2 355.9 259.7 362.3L286.1 400.1L347.5 299.6C351.9 292.5 359.6 288.1 368 288.1z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="rotate-solid-full">
    <path d="M544.1 256L552 256C565.3 256 576 245.3 576 232L576 88C576 78.3 570.2 69.5 561.2 65.8C552.2 62.1 541.9 64.2 535 71L483.3 122.8C439 86.1 382 64 320 64C191 64 84.3 159.4 66.6 283.5C64.1 301 76.2 317.2 93.7 319.7C111.2 322.2 127.4 310 129.9 292.6C143.2 199.5 223.3 128 320 128C364.4 128 405.2 143 437.7 168.3L391 215C384.1 221.9 382.1 232.2 385.8 241.2C389.5 250.2 398.3 256 408 256L544.1 256zM573.5 356.5C576 339 563.8 322.8 546.4 320.3C529 317.8 512.7 330 510.2 347.4C496.9 440.4 416.8 511.9 320.1 511.9C275.7 511.9 234.9 496.9 202.4 471.6L249 425C255.9 418.1 257.9 407.8 254.2 398.8C250.5 389.8 241.7 384 232 384L88 384C74.7 384 64 394.7 64 408L64 552C64 561.7 69.8 570.5 78.8 574.2C87.8 577.9 98.1 575.8 105 569L156.8 517.2C201 553.9 258 576 320 576C449 576 555.7 480.6 573.4 356.5z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="triangle-exclamation-solid-full">
    <path d="M320 64C334.7 64 348.2 72.1 355.2 85L571.2 485C577.9 497.4 577.6 512.4 570.4 524.5C563.2 536.6 550.1 544 536 544L104 544C89.9 544 76.8 536.6 69.6 524.5C62.4 512.4 62.1 497.4 68.8 485L284.8 85C291.8 72.1 305.3 64 320 64zM320 416C302.3 416 288 430.3 288 448C288 465.7 302.3 480 320 480C337.7 480 352 465.7 352 448C352 430.3 337.7 416 320 416zM320 224C301.8 224 287.3 239.5 288.6 257.7L296 361.7C296.9 374.2 307.4 384 319.9 384C332.5 384 342.9 374.3 343.8 361.7L351.2 257.7C352.5 239.5 338.1 224 319.8 224z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" id="upload-solid-full">
    <path d="M352 173.3L352 384C352 401.7 337.7 416 320 416C302.3 416 288 401.7 288 384L288 173.3L246.6 214.7C234.1 227.2 213.8 227.2 201.3 214.7C188.8 202.2 188.8 181.9 201.3 169.4L297.3 73.4C309.8 60.9 330.1 60.9 342.6 73.4L438.6 169.4C451.1 181.9 451.1 202.2 438.6 214.7C426.1 227.2 405.8 227.2 393.3 214.7L352 173.3zM320 464C364.2 464 400 428.2 400 384L480 384C515.3 384 544 412.7 544 448L544 480C544 515.3 515.3 544 480 544L160 544C124.7 544 96 515.3 96 480L96 448C96 412.7 124.7 384 160 384L240 384C240 428.2 275.8 464 320 464zM464 488C477.3 488 488 477.3 488 464C488 450.7 477.3 440 464 440C450.7 440 440 450.7 440 464C440 477.3 450.7 488 464 488z"></path>
  </symbol>
</svg>
    <div class="bg-pattern"></div>
    <div class="container">
        <header>
            <h1>ORM游戏贴图合成与拆解</h1>
            <p class="subtitle">上传AO、粗糙度、金属度和透明度贴图自动合成ORM纹理贴图，或上传ORM贴图拆解为独立通道</p>
        </header>
        
        <div class="main-content">
            <section class="upload-section">
                <h2 class="section-title"><svg class="icon"><use xlink:href="#upload-solid-full"></use></svg>
上传贴图通道
		<div class="format-support">
                    支持格式: JPG, PNG, BMP, TIFF, WEBP
                </div>
		</h2>
                
                <div id="status" class="status waiting">
                    <svg class="icon"><use xlink:href="#circle-exclamation-solid-full"></use></svg>等待上传贴图
                </div>

                <div class="upload-container">
                    <div class="upload-box" id="ao-box">
                        <div class="upload-hint">
                            <span class="channel-label ao-label">
                                AO (环境光遮蔽)
                            </span>
                            <span class="drag-text">+ 拖拽或点击上传</span>
                        </div>
                        <div class="preview-img" id="ao-preview"></div>
                        <div class="preview-overlay">
                            <button class="delete-btn" data-type="ao" style="display: none;">×</button>
                        </div>
                        <div class="download-bt" data-type="ao" style="display: none;">
                            <svg class="icon"><use xlink:href="#download-solid-full"></use></svg>
                        </div>
                        <input type="file" id="ao-input" accept=".jpg,.jpeg,.png,.bmp,.tif,.tiff,.webp">
                    </div>
                    
                    <div class="upload-box" id="roughness-box">
                        <div class="upload-hint">
                            <span class="channel-label roughness-label">
                                粗糙度 (Roughness)
                            </span>
                            <span class="drag-text">+ 拖拽或点击上传</span>
                        </div>
                        <div class="preview-img" id="roughness-preview"></div>
                        <div class="preview-overlay">
                            <button class="delete-btn" data-type="roughness" style="display: none;">×</button>
                        </div>
                        <div class="download-bt" data-type="roughness" style="display: none;">
                            <svg class="icon"><use xlink:href="#download-solid-full"></use></svg>
                        </div>
                        <input type="file" id="roughness-input" accept=".jpg,.jpeg,.png,.bmp,.tif,.tiff,.webp">
                    </div>
                    
                    <div class="upload-box" id="metallic-box">
                        <div class="upload-hint">
                            <span class="channel-label metallic-label">
                                金属度 (Metallic)
                            </span>
                            <span class="drag-text">+ 拖拽或点击上传</span>
                        </div>
                        <div class="preview-img" id="metallic-preview"></div>
                        <div class="preview-overlay">
                            <button class="delete-btn" data-type="metallic" style="display: none;">×</button>
                        </div>
                        <div class="download-bt" data-type="metallic" style="display: none;">
                            <svg class="icon"><use xlink:href="#download-solid-full"></use></svg>
                        </div>
                        <input type="file" id="metallic-input" accept=".jpg,.jpeg,.png,.bmp,.tif,.tiff,.webp">
                    </div>
                    
                    <div class="upload-box" id="alpha-box">
                        <div class="upload-hint">
                            <span class="channel-label alpha-label">
                                透明度 (Alpha)
                            </span>
                            <span class="drag-text">+ 拖拽或点击上传</span>
                        </div>
                        <div class="preview-img" id="alpha-preview"></div>
                        <div class="preview-overlay">
                            <button class="delete-btn" data-type="alpha" style="display: none;">×</button>
                        </div>
                        <div class="download-bt" data-type="alpha" style="display: none;">
                            <svg class="icon"><use xlink:href="#download-solid-full"></use></svg>
                        </div>
                        <input type="file" id="alpha-input" accept=".jpg,.jpeg,.png,.bmp,.tif,.tiff,.webp">
                    </div>
                </div>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3983418855272291"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:none"
     data-ad-format="fluid"
     data-ad-layout-key="-h3-9+1l-3v+4n"
     data-ad-client="ca-pub-3983418855272291"
     data-ad-slot="8823242656"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
            </section>
            
            <section class="preview-section">
                <h2 class="section-title"><svg class="icon"><use xlink:href="#image-solid-full"></use></svg> 合成结果与拆解</h2>
                
                <div class="result-container" id="result-container">
                    <div class="result-img" id="result-preview">
                        <div style="text-align: center; padding: 20px;" class="default-placeholder">
                            <i class="fas fa-sync-alt fa-spin" style="font-size: 3.5rem; margin-bottom: 20px; opacity: 0.5;"></i>
                            <p>上传图片后自动合成</p>
                        </div>
                    </div>
                    
                    <div class="decompose-overlay" id="decompose-overlay">
                        <div class="decompose-icon">
                            <i class="fas fa-file-import"></i>
                        </div>
                        <div class="decompose-text">拖拽ORMA贴图到此拆解</div>
                        <div class="decompose-hint">将合成后的ORMA贴图拖拽到此处，工具会自动拆解为AO、粗糙度、金属度和透明度贴图</div>
                        <div class="format-support" style="margin-top: 15px;">支持格式: JPG, PNG, BMP, TIFF, WEBP</div>
                    </div>
                    
                    <div class="action-buttons">
                        <div style="display: grid; gap: 10px; grid-template-columns: 1fr 1fr;">
                            <button id="orm-upload-btn" class="btn orm-upload-btn">
                                <i class="fas fa-upload"></i> 上传ORM
                            </button>
                            <button id="decompose-btn" class="btn decompose-btn">
                                <i class="fas fa-cogs"></i> 拆解ORM
                            </button>
                        </div>
                        <button id="download-bt" class="btn" disabled>
                            <i class="fas fa-download"></i> 下载贴图
                        </button>
                    </div>
                </div>
            </section>
        </div>
        
        <div class="instructions">
            <h2 class="section-title"><i class="fas fa-info-circle"></i> 说明</h2>
            <ul>
                <li><strong>合成模式</strong>：上传AO、粗糙度、金属度和透明度贴图，工具会自动合成ORMA贴图</li>
                <li><strong>拆解模式</strong>：拖拽ORMA贴图到结果区域，工具会拆解为四个通道的独立贴图</li>
 		<li><strong> 红色通道(R)</strong>: AO贴图（默认纯白）；<strong> 绿色通道(G)</strong> : 粗糙度贴图（默认纯白）；<strong> 蓝色通道(B)</strong> : 金属度贴图（默认纯白）；<strong> 透明度通道(A)</strong> : 透明度贴图（默认纯白）</li>
            </ul>
        </div>
    </div>
    
    <div id="image-modal" class="modal">
        <span class="modal-close">&times;</span>
        <img class="modal-content" id="modal-image">
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 获取DOM元素
            const aoBox = document.getElementById('ao-box');
            const roughnessBox = document.getElementById('roughness-box');
            const metallicBox = document.getElementById('metallic-box');
            const alphaBox = document.getElementById('alpha-box');
            
            const aoInput = document.getElementById('ao-input');
            const roughnessInput = document.getElementById('roughness-input');
            const metallicInput = document.getElementById('metallic-input');
            const alphaInput = document.getElementById('alpha-input');
            
            const aoPreview = document.getElementById('ao-preview');
            const roughnessPreview = document.getElementById('roughness-preview');
            const metallicPreview = document.getElementById('metallic-preview');
            const alphaPreview = document.getElementById('alpha-preview');
            const resultPreview = document.getElementById('result-preview');
            const resultContainer = document.getElementById('result-container');
            const decomposeOverlay = document.getElementById('decompose-overlay');
            
            const downloadBtn = document.getElementById('download-bt');
            const decomposeBtn = document.getElementById('decompose-btn');
            const status = document.getElementById('status');
            const ormUploadBtn = document.getElementById('orm-upload-btn');
            
            // 模态框元素
            const modal = document.getElementById('image-modal');
            const modalImg = document.getElementById('modal-image');
            const modalClose = document.querySelector('.modal-close');
            
            // 存储上传的图片
            const images = {
                ao: null,
                roughness: null,
                metallic: null,
                alpha: null,
                orma: null
            };
            
            // 存储每个通道的原始URL
            const imageUrls = {
                ao: null,
                roughness: null,
                metallic: null,
                alpha: null
            };
            
            // 支持的图像格式
            const supportedFormats = ['image/jpeg', 'image/png', 'image/bmp', 'image/tiff', 'image/webp'];
            
            // 自动合成计时器
            let synthesisTimer = null;
            
            // 初始化
            init();
            
            function init() {
                // 设置拖拽事件
                setupDragAndDrop(aoBox, aoInput, 'ao');
                setupDragAndDrop(roughnessBox, roughnessInput, 'roughness');
                setupDragAndDrop(metallicBox, metallicInput, 'metallic');
                setupDragAndDrop(alphaBox, alphaInput, 'alpha');
                
                // 为结果容器设置拖拽事件
                setupResultDrag();
                
                // 文件选择事件
                aoInput.addEventListener('change', (e) => handleFileSelect(e, 'ao'));
                roughnessInput.addEventListener('change', (e) => handleFileSelect(e, 'roughness'));
                metallicInput.addEventListener('change', (e) => handleFileSelect(e, 'metallic'));
                alphaInput.addEventListener('change', (e) => handleFileSelect(e, 'alpha'));
                
                // --- 修复开始 ---
                // 点击上传区域时，如果该区域没有图片，则触发文件选择
                aoBox.addEventListener('click', (e) => {
                    if (!images.ao) {
                        e.stopPropagation(); // 阻止事件冒泡到父元素
                        aoInput.click();
                    }
                });
                roughnessBox.addEventListener('click', (e) => {
                    if (!images.roughness) {
                        e.stopPropagation();
                        roughnessInput.click();
                    }
                });
                metallicBox.addEventListener('click', (e) => {
                    if (!images.metallic) {
                        e.stopPropagation();
                        metallicInput.click();
                    }
                });
                alphaBox.addEventListener('click', (e) => {
                    if (!images.alpha) {
                        e.stopPropagation();
                        alphaInput.click();
                    }
                });

                // 为预览图片添加点击事件，用于放大
                aoPreview.addEventListener('click', (e) => {
                    if (images.ao) {
                        e.stopPropagation(); // 防止事件冒泡到upload-box
                        showModal(imageUrls.ao);
                    }
                });
                roughnessPreview.addEventListener('click', (e) => {
                    if (images.roughness) {
                        e.stopPropagation();
                        showModal(imageUrls.roughness);
                    }
                });
                metallicPreview.addEventListener('click', (e) => {
                    if (images.metallic) {
                        e.stopPropagation();
                        showModal(imageUrls.metallic);
                    }
                });
                alphaPreview.addEventListener('click', (e) => {
                    if (images.alpha) {
                        e.stopPropagation();
                        showModal(imageUrls.alpha);
                    }
                });
                // --- 修复结束 ---
                
                // ORM上传按钮
                ormUploadBtn.addEventListener('click', () => {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = '.jpg,.jpeg,.png,.bmp,.tif,.tiff,.webp';
                    input.onchange = (e) => {
                        if (e.target.files && e.target.files[0]) {
                            const file = e.target.files[0];
                            handleORMFile(file);
                        }
                    };
                    input.click();
                });
                
                // 下载按钮事件
                downloadBtn.addEventListener('click', downloadResult);
                
                // 拆解按钮事件
                decomposeBtn.addEventListener('click', () => {
                    if (images.orma) {
                        decomposeORM(images.orma);
                    } else {
                        // 如果没有ORM图片，触发文件选择
                        const input = document.createElement('input');
                        input.type = 'file';
                        input.accept = '.jpg,.jpeg,.png,.bmp,.tif,.tiff,.webp';
                        input.onchange = (e) => {
                            if (e.target.files && e.target.files[0]) {
                                const file = e.target.files[0];
                                handleORMFile(file);
                            }
                        };
                        input.click();
                    }
                });
                
                // 模态框关闭
                modalClose.onclick = function() {
                    modal.style.display = 'none';
                };
                
                // 点击模态框背景关闭
                modal.onclick = function(e) {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                    }
                };
            }
            
            // 处理ORM文件上传
            function handleORMFile(file) {
                if (!file.type || !supportedFormats.includes(file.type.toLowerCase())) {
                    updateStatus(`<i class="fas fa-exclamation-triangle"></i> 不支持的格式: ${file.type || '未知格式'}`, 'error');
                    return;
                }
                
                // 更新状态
                updateStatus(`<i class="fas fa-spinner fa-spin"></i> 正在加载ORMA贴图...`, 'processing');
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const buffer = e.target.result;
                    const img = new Image();
                    
                    if (file.type === 'image/tiff') {
                        // 处理TIFF格式
                        try {
                            const ifds = UTIF.decode(buffer);
                            if (ifds.length === 0) throw new Error('无效的TIFF文件');
                            
                            UTIF.decodeImage(buffer, ifds[0]);
                            const rgba = UTIF.toRGBA8(ifds[0]);
                            
                            const canvas = document.createElement('canvas');
                            canvas.width = ifds[0].width;
                            canvas.height = ifds[0].height;
                            const ctx = canvas.getContext('2d');
                            const imageData = ctx.createImageData(canvas.width, canvas.height);
                            
                            for (let i = 0; i < rgba.length; i++) {
                                imageData.data[i] = rgba[i];
                            }
                            
                            ctx.putImageData(imageData, 0, 0);
                            
                            img.onload = function() {
                                images.orma = img;
                                displayResultImage(canvas.toDataURL('image/png'));
                                decomposeORM(img);
                            };
                            
                            img.src = canvas.toDataURL('image/png');
                        } catch (error) {
                            updateStatus(`<i class="fas fa-exclamation-triangle"></i> TIFF解析失败: ${error.message}`, 'error');
                        }
                    } else {
                        img.onload = function() {
                            images.orma = img;
                            displayResultImage(URL.createObjectURL(file));
                            decomposeORM(img);
                        };
                        img.src = URL.createObjectURL(file);
                    }
                };
                
                reader.readAsArrayBuffer(file);
            }
            
            // 设置拖拽区域功能
            function setupDragAndDrop(box, input, type) {
                // 拖拽事件 - 阻止默认行为
                box.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    box.classList.add('drag-over');
                });
                
                box.addEventListener('dragenter', (e) => {
                    e.preventDefault();
                    box.classList.add('drag-over');
                });
                
                box.addEventListener('dragleave', () => {
                    box.classList.remove('drag-over');
                });
                
                box.addEventListener('drop', (e) => {
                    e.preventDefault();
                    box.classList.remove('drag-over');
                    
                    if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
                        handleDroppedFile(e.dataTransfer.files[0], type);
                    }
                });
            }
            
            // 设置结果区域的拖拽事件
            function setupResultDrag() {
                // 拖拽事件 - 阻止默认行为
                resultContainer.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    resultContainer.classList.add('drag-over');
                    // 显示拆解提示层
                    decomposeOverlay.style.opacity = '1';
                    decomposeOverlay.style.pointerEvents = 'auto';
                });
                
                resultContainer.addEventListener('dragenter', (e) => {
                    e.preventDefault();
                    resultContainer.classList.add('drag-over');
                    // 显示拆解提示层
                    decomposeOverlay.style.opacity = '1';
                    decomposeOverlay.style.pointerEvents = 'auto';
                });
                
                resultContainer.addEventListener('dragleave', (e) => {
                    // 确保鼠标离开整个结果区域
                    if (!resultContainer.contains(e.relatedTarget)) {
                        resultContainer.classList.remove('drag-over');
                        // 隐藏拆解提示层
                        decomposeOverlay.style.opacity = '0';
                        decomposeOverlay.style.pointerEvents = 'none';
                    }
                });
                
                resultContainer.addEventListener('drop', (e) => {
                    e.preventDefault();
                    resultContainer.classList.remove('drag-over');
                    // 隐藏拆解提示层
                    decomposeOverlay.style.opacity = '0';
                    decomposeOverlay.style.pointerEvents = 'none';
                    
                    if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
                        handleDroppedFile(e.dataTransfer.files[0], 'orma');
                    }
                });
            }
            
            // 处理拖放的文件
            function handleDroppedFile(file, type) {
                if (!file.type || !supportedFormats.includes(file.type.toLowerCase())) {
                    updateStatus(`<i class="fas fa-exclamation-triangle"></i> 不支持的格式: ${file.type || '未知格式'}`, 'error');
                    return;
                }
                
                if (type === 'orma') {
                    updateStatus(`<i class="fas fa-spinner fa-spin"></i> 正在加载ORMA贴图...`, 'processing');
                } else {
                    updateStatus(`<i class="fas fa-spinner fa-spin"></i> 正在加载 ${type.toUpperCase()} 图片...`, 'processing');
                }
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const buffer = e.target.result;
                    const img = new Image();
                    
                    if (file.type === 'image/tiff') {
                        // 处理TIFF格式
                        try {
                            const ifds = UTIF.decode(buffer);
                            if (ifds.length === 0) throw new Error('无效的TIFF文件');
                            
                            UTIF.decodeImage(buffer, ifds[0]);
                            const rgba = UTIF.toRGBA8(ifds[0]);
                            
                            const canvas = document.createElement('canvas');
                            canvas.width = ifds[0].width;
                            canvas.height = ifds[0].height;
                            const ctx = canvas.getContext('2d');
                            const imageData = ctx.createImageData(canvas.width, canvas.height);
                            
                            for (let i = 0; i < rgba.length; i++) {
                                imageData.data[i] = rgba[i];
                            }
                            
                            ctx.putImageData(imageData, 0, 0);
                            
                            img.onload = function() {
                                if (type === 'orma') {
                                    images.orma = img;
                                    displayResultImage(canvas.toDataURL('image/png'));
                                    decomposeORM(img);
                                } else {
                                    images[type] = img;
                                    imageUrls[type] = canvas.toDataURL('image/png');
                                    updatePreview(type, imageUrls[type]);
                                    autoSynthesizeORM();
                                }
                            };
                            
                            img.src = canvas.toDataURL('image/png');
                        } catch (error) {
                            updateStatus(`<i class="fas fa-exclamation-triangle"></i> TIFF解析失败: ${error.message}`, 'error');
                        }
                    } else {
                        img.onload = function() {
                            if (type === 'orma') {
                                images.orma = img;
                                displayResultImage(URL.createObjectURL(file));
                                decomposeORM(img);
                            } else {
                                images[type] = img;
                                imageUrls[type] = URL.createObjectURL(file);
                                updatePreview(type, imageUrls[type]);
                                autoSynthesizeORM();
                            }
                        };
                        img.src = URL.createObjectURL(file);
                    }
                };
                
                reader.readAsArrayBuffer(file);
            }
            
            // 处理文件选择
            function handleFileSelect(event, type) {
                const file = event.target.files[0];
                if (!file) return;
                
                handleDroppedFile(file, type);
            }
            
            // 删除图片
            function deleteImage(type) {
                if (images[type] && images[type].src.startsWith('blob:')) {
                    URL.revokeObjectURL(images[type].src);
                }
                // 清除图片
                images[type] = null;
                imageUrls[type] = null;
                
                // 重置预览
                const preview = document.getElementById(`${type}-preview`);
                preview.innerHTML = '';
                
                // 显示上传提示
                const hint = document.getElementById(`${type}-box`).querySelector('.upload-hint');
                hint.style.display = 'block';
                setTimeout(() => {
                    hint.style.opacity = '1';
                }, 10);
                
                // 隐藏删除按钮
                document.querySelector(`.delete-btn[data-type="${type}"]`).style.display = 'none';
                
                // 隐藏下载按钮
                document.querySelector(`.download-bt[data-type="${type}"]`).style.display = 'none';
                
                // 重置文件输入
                document.getElementById(`${type}-input`).value = '';
                
                // 更新状态
                updateStatus(`<i class="fas fa-info-circle"></i> ${type.toUpperCase()}图片已删除`, 'waiting');
                
                // 自动触发合成
                autoSynthesizeORM();
            }
            
            // 更新预览
            function updatePreview(type, src) {
                const preview = document.getElementById(`${type}-preview`);
                preview.innerHTML = `<img src="${src}" alt="${type} preview">`;
                
                // 隐藏上传提示
                const hint = document.getElementById(`${type}-box`).querySelector('.upload-hint');
                if (hint) {
                    hint.style.opacity = '0';
                    setTimeout(() => {
                        hint.style.display = 'none';
                    }, 300);
                }
                
                // 显示删除按钮
                const deleteBtn = document.querySelector(`.delete-btn[data-type="${type}"]`);
                deleteBtn.style.display = 'block';
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    deleteImage(type);
                };
                
                // 显示下载按钮
                const downloadBtn = document.querySelector(`.download-bt[data-type="${type}"]`);
                downloadBtn.style.display = 'block';
                downloadBtn.onclick = (e) => {
                    e.stopPropagation();
                    downloadChannel(type);
                };
                
                // 添加点击放大事件 - 之前在这里添加了点击放大事件，现在改在init()中集中处理，并阻止事件冒泡
                // const imgElement = preview.querySelector('img');
                // imgElement.onclick = () => {
                //     showModal(src);
                // };
            }
            
            // 下载单个通道
            function downloadChannel(type) {
                if (!imageUrls[type]) return;
                
                const link = document.createElement('a');
                link.download = `${type}_texture.png`;
                link.href = imageUrls[type];
                link.click();
            }
            
            // 显示结果图片
            function displayResultImage(src) {
                resultPreview.innerHTML = `<img src="${src}" alt="ORMA合成结果">`;
                resultPreview.querySelector('img').onclick = () => {
                    showModal(src);
                };
            }
            
            // 自动合成ORM贴图
            function autoSynthesizeORM() {
                // 清除之前的定时器
                if (synthesisTimer) {
                    clearTimeout(synthesisTimer);
                }
                
                // 设置新的定时器（300ms后执行合成）
                synthesisTimer = setTimeout(() => {
                    // 更新状态
                    updateStatus('<i class="fas fa-sync-alt fa-spin"></i> 正在合成贴图...', 'processing');
                    
                    // 实际合成
                    setTimeout(performSynthesis, 300);
                }, 300);
            }
            
            // 执行合成操作
            function performSynthesis() {
                // 创建Canvas
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // 确定尺寸 - 使用第一个存在的图片尺寸，都不存在则使用默认512x512
                let width = 512;
                let height = 512;
                
                if (images.ao) {
                    width = images.ao.width;
                    height = images.ao.height;
                } else if (images.roughness) {
                    width = images.roughness.width;
                    height = images.roughness.height;
                } else if (images.metallic) {
                    width = images.metallic.width;
                    height = images.metallic.height;
                } else if (images.alpha) {
                    width = images.alpha.width;
                    height = images.alpha.height;
                }
                
                canvas.width = width;
                canvas.height = height;
                
                // 绘制AO（红色通道）或纯白色
                if (images.ao) {
                    ctx.drawImage(images.ao, 0, 0);
                } else {
                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(0, 0, width, height);
                }
                const aoData = ctx.getImageData(0, 0, width, height);
                
                // 绘制粗糙度（绿色通道）或纯白色
                ctx.clearRect(0, 0, width, height);
                if (images.roughness) {
                    ctx.drawImage(images.roughness, 0, 0);
                } else {
                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(0, 0, width, height);
                }
                const roughnessData = ctx.getImageData(0, 0, width, height);
                
                // 绘制金属度（蓝色通道）或纯白色
                ctx.clearRect(0, 0, width, height);
                if (images.metallic) {
                    ctx.drawImage(images.metallic, 0, 0);
                } else {
                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(0, 0, width, height);
                }
                const metallicData = ctx.getImageData(0, 0, width, height);
                
                // 绘制透明度（Alpha通道）或纯白色
                ctx.clearRect(0, 0, width, height);
                if (images.alpha) {
                    ctx.drawImage(images.alpha, 0, 0);
                } else {
                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(0, 0, width, height);
                }
                const alphaData = ctx.getImageData(0, 0, width, height);
                
                // 创建新的ImageData
                const outputData = ctx.createImageData(width, height);
                
                // 合成ORMA贴图
                for (let i = 0; i < outputData.data.length; i += 4) {
                    // 红色通道: AO
                    outputData.data[i] = aoData.data[i];
                    
                    // 绿色通道: 粗糙度
                    outputData.data[i + 1] = roughnessData.data[i];
                    
                    // 蓝色通道: 金属度
                    outputData.data[i + 2] = metallicData.data[i];
                    
                    // Alpha通道: 透明度
                    outputData.data[i + 3] = alphaData.data[i];
                }
                
                // 将合成数据绘制到Canvas
                ctx.putImageData(outputData, 0, 0);
                
                // 显示合成结果
                const dataUrl = canvas.toDataURL('image/png');
                displayResultImage(dataUrl);
                
                // 存储ORMA图片
                const ormaImg = new Image();
                ormaImg.src = dataUrl;
                images.orma = ormaImg;
                
                // 启用下载按钮
                downloadBtn.disabled = false;
                downloadBtn.dataset.url = dataUrl;
                
                // 更新状态
                updateStatus('<i class="fas fa-check-circle"></i> ORMA贴图合成完成！', 'ready');
            }
            
            // 拆解ORM贴图
            function decomposeORM(ormImage) {
                // 更新状态
                updateStatus('<i class="fas fa-cogs fa-spin"></i> 正在拆解ORMA贴图...', 'decompose');
                
                setTimeout(() => {
                    // 创建Canvas
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // 设置Canvas尺寸
                    canvas.width = ormImage.width;
                    canvas.height = ormImage.height;
                    
                    // 绘制ORM图片
                    ctx.drawImage(ormImage, 0, 0);
                    const ormData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    
                    // 创建四个通道的ImageData
                    const aoData = ctx.createImageData(canvas.width, canvas.height);
                    const roughnessData = ctx.createImageData(canvas.width, canvas.height);
                    const metallicData = ctx.createImageData(canvas.width, canvas.height);
                    const alphaData = ctx.createImageData(canvas.width, canvas.height);
                    
                    // 提取通道数据
                    for (let i = 0; i < ormData.data.length; i += 4) {
                        // AO通道 (红色)
                        aoData.data[i] = ormData.data[i]; // R
                        aoData.data[i + 1] = ormData.data[i]; // G
                        aoData.data[i + 2] = ormData.data[i]; // B
                        aoData.data[i + 3] = 255; // A
                        
                        // 粗糙度通道 (绿色)
                        roughnessData.data[i] = ormData.data[i + 1]; // R
                        roughnessData.data[i + 1] = ormData.data[i + 1]; // G
                        roughnessData.data[i + 2] = ormData.data[i + 1]; // B
                        roughnessData.data[i + 3] = 255; // A
                        
                        // 金属度通道 (蓝色)
                        metallicData.data[i] = ormData.data[i + 2]; // R
                        metallicData.data[i + 1] = ormData.data[i + 2]; // G
                        metallicData.data[i + 2] = ormData.data[i + 2]; // B
                        metallicData.data[i + 3] = 255; // A
                        
                        // 透明度通道 (Alpha)
                        alphaData.data[i] = ormData.data[i + 3]; // R
                        alphaData.data[i + 1] = ormData.data[i + 3]; // G
                        alphaData.data[i + 2] = ormData.data[i + 3]; // B
                        alphaData.data[i + 3] = 255; // A
                    }
                    
                    // 创建四个通道的图片
                    ctx.putImageData(aoData, 0, 0);
                    const aoUrl = canvas.toDataURL('image/png');
                    
                    ctx.putImageData(roughnessData, 0, 0);
                    const roughnessUrl = canvas.toDataURL('image/png');
                    
                    ctx.putImageData(metallicData, 0, 0);
                    const metallicUrl = canvas.toDataURL('image/png');
                    
                    ctx.putImageData(alphaData, 0, 0);
                    const alphaUrl = canvas.toDataURL('image/png');
                    
                    // 更新预览
                    updatePreviewWithUrl('ao', aoUrl);
                    updatePreviewWithUrl('roughness', roughnessUrl);
                    updatePreviewWithUrl('metallic', metallicUrl);
                    updatePreviewWithUrl('alpha', alphaUrl);
                    
                    // 存储图片对象
                    images.ao = new Image();
                    images.ao.src = aoUrl;
                    imageUrls.ao = aoUrl;
                    
                    images.roughness = new Image();
                    images.roughness.src = roughnessUrl;
                    imageUrls.roughness = roughnessUrl;
                    
                    images.metallic = new Image();
                    images.metallic.src = metallicUrl;
                    imageUrls.metallic = metallicUrl;
                    
                    images.alpha = new Image();
                    images.alpha.src = alphaUrl;
                    imageUrls.alpha = alphaUrl;
                    
                    // 更新状态
                    updateStatus('<i class="fas fa-check-circle"></i> ORMA贴图拆解完成！', 'ready');
                    
                    // 启用下载按钮
                    downloadBtn.disabled = false;
                    downloadBtn.dataset.url = ormImage.src;
                    
                }, 500);
            }
            
            // 使用URL更新预览
            function updatePreviewWithUrl(type, url) {
                const preview = document.getElementById(`${type}-preview`);
                preview.innerHTML = `<img src="${url}" alt="${type} preview">`;
                
                // 隐藏上传提示
                const hint = document.getElementById(`${type}-box`).querySelector('.upload-hint');
                if (hint) {
                    hint.style.opacity = '0';
                    setTimeout(() => {
                        hint.style.display = 'none';
                    }, 300);
                }
                
                // 显示删除按钮
                const deleteBtn = document.querySelector(`.delete-btn[data-type="${type}"]`);
                deleteBtn.style.display = 'block';
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    deleteImage(type);
                };
                
                // 显示下载按钮
                const downloadBtn = document.querySelector(`.download-bt[data-type="${type}"]`);
                downloadBtn.style.display = 'block';
                downloadBtn.onclick = (e) => {
                    e.stopPropagation();
                    downloadChannel(type);
                };
            }
            
            // 显示模态框
            function showModal(src) {
                modal.style.display = 'flex';
                modalImg.src = src;
            }
            
            // 下载结果
            function downloadResult() {
                const link = document.createElement('a');
                link.download = 'orma_texture.png';
                link.href = downloadBtn.dataset.url;
                link.click();
            }
            
            // 更新状态
            function updateStatus(message, statusClass) {
                status.innerHTML = message;
                status.className = `status ${statusClass}`;
            }
        });
    </script>
</body>
</html>